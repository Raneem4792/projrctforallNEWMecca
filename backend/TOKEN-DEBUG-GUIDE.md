# ๐ ุฏููู ุชุดุฎูุต ูุดููุฉ ุงูุชููู

## ๐ฏ **ุงููุดููุฉ:**
ุตูุญุฉ ุณุฌู ุงูุจูุงุบุงุช ุชุจูู ูุงุฑุบุฉ ุฑุบู ูุฌูุฏ ุงูุจูุงุบุงุช ูู ูุงุนุฏุฉ ุงููุณุชุดููุ ูุงูุณุจุจ ูู "ุงูุชุญูู ูู ุงูุชููู" ุฃู "ุชูุฑูุฑู" ุจูู ุงููุงุฌูุฉ ูุงูุณูุฑูุฑ.

## ๐ **ุงูุชุญููู:**

### **ุงูููุทู ุงูุตุญูุญ:**
1. ุงููุณุชุฎุฏู ููุธู
2. ุงูุจูุงุบุงุช ูู ูุงุนุฏุฉ ูุณุชุดูุงู ููุท
3. ุงูุณูุฑูุฑ ููุฑุฃ `hospitalId` ูู ุงูุชููู
4. ูุฐูุจ ููุงุนุฏุฉ ุงููุณุชุดูู ูุจุงุดุฑุฉ

### **ุงููุดููุฉ ุงููุญุชููุฉ:**
- ุงูุชููู ุบูุฑ ููุฌูุฏ ูู `localStorage`
- ุงูุชููู ููุชูู ุงูุตูุงุญูุฉ
- ุงูุชููู ูุง ูุญุชูู ุนูู `hospitalId`
- ูุดููุฉ ูู `JWT_SECRET`

## ๐งช **ุฎุทูุงุช ุงูุชุดุฎูุต:**

### **1. ูุญุต ุงูุชููู ูู ุงููุชุตูุญ:**
```javascript
// ูุชุญ Developer Tools (F12)
// ูู Console:
console.log('ุงูุชููู:', localStorage.getItem('token'));

// ุฅุฐุง ูุงู ููุฌูุฏุงูุ ูุญุต ูุญุชูุงู:
const token = localStorage.getItem('token');
if (token) {
  // ูู ุชุดููุฑ ุงูุชููู (ุจุฏูู ุงูุชุญูู ูู ุงูุชูููุน)
  const payload = JSON.parse(atob(token.split('.')[1]));
  console.log('ูุญุชูู ุงูุชููู:', payload);
  console.log('hospitalId:', payload.hospitalId);
}
```

### **2. ูุญุต ุฅุฑุณุงู ุงูุชููู:**
```javascript
// ูู Network tab:
// 1. ูุชุญ ุตูุญุฉ ุณุฌู ุงูุจูุงุบุงุช
// 2. ูุฑุงูุจุฉ ุทูุจ /api/complaints/history
// 3. ูุญุต Headers:
//    - Authorization: Bearer [token]
//    - ูุฌุจ ุฃู ูููู ููุฌูุฏุงู
```

### **3. ูุญุต console ุงููุชุตูุญ:**
```
๐ ุฅุฑุณุงู ุงูุชููู ูุน ุทูุจ ุณุฌู ุงูุจูุงุบุงุช
๐ ุงูุชููู: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
๐ ุทูุจ API: http://localhost:3001/api/complaints/history?page=1&pageSize=9
```

### **4. ูุญุต console ุงูุณูุฑูุฑ:**
```
๐ [AUTH] ุงูุชุญูู ูู ุงูุชููู: { hasHeader: true, hasToken: true, tokenPreview: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' }
โ [AUTH] ุงูุชููู ุตุงูุญ: { userId: 1, roleId: 2, hospitalId: 11, username: 'admin' }
๐ [HISTORY] ุงูุจุญุซ | hospitalId: 11 | roleId: 2 | page: 1
๐ ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงููุณุชุดูู 11 ูุจุฏูู ุงุญุชูุงุทู
```

## ๐ง **ุงูุญููู ุงููุญุชููุฉ:**

### **ุงูุญู 1: ุงูุชููู ุบูุฑ ููุฌูุฏ**
```javascript
// ูู console ุงููุชุตูุญ:
localStorage.getItem('token'); // ูุฌุจ ุฃู ูุนูุฏ ุชููู

// ุฅุฐุง ูุงู null:
// 1. ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู
// 2. ุงูุชุฃูุฏ ูู ุญูุธ ุงูุชููู ูู localStorage
```

### **ุงูุญู 2: ุงูุชููู ููุชูู ุงูุตูุงุญูุฉ**
```javascript
// ูุญุต ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ:
const token = localStorage.getItem('token');
const payload = JSON.parse(atob(token.split('.')[1]));
const exp = new Date(payload.exp * 1000);
console.log('ููุชูู ูู:', exp);

// ุฅุฐุง ุงูุชูุช ุงูุตูุงุญูุฉ:
// 1. ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู
// 2. ุชุญุฏูุซ ุงูุชููู
```

### **ุงูุญู 3: ุงูุชููู ูุง ูุญุชูู ุนูู hospitalId**
```javascript
// ูุญุต ูุญุชูู ุงูุชููู:
const token = localStorage.getItem('token');
const payload = JSON.parse(atob(token.split('.')[1]));
console.log('hospitalId:', payload.hospitalId);

// ุฅุฐุง ูุงู undefined:
// 1. ุงูุชุฃูุฏ ูู ุฅุฑุณุงู hospitalId ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
// 2. ุชุญุฏูุซ ุงูุชููู
```

### **ุงูุญู 4: ูุดููุฉ ูู JWT_SECRET**
```bash
# ูู .env:
JWT_SECRET=your-secret-key

# ุงูุชุฃูุฏ ูู ูุฌูุฏู:
echo $JWT_SECRET
```

## ๐งช **ุงุฎุชุจุงุฑ ุณุฑูุน:**

### **1. ุงุฎุชุจุงุฑ ุงูุชููู:**
```bash
cd backend
node debug-token-issue.js
```

### **2. ุงุฎุชุจุงุฑ ุชุฏูู ุงูุชููู:**
```bash
cd backend
node test-token-flow.js
```

### **3. ุงุฎุชุจุงุฑ ูุฏูู:**
```bash
# 1. ูุชุญ ุตูุญุฉ ุณุฌู ุงูุจูุงุบุงุช
# 2. ูุชุญ Developer Tools
# 3. ูุฑุงูุจุฉ console ู Network
# 4. ุงูุจุญุซ ุนู ุฑุณุงุฆู ุงูุชููู
```

## ๐ **ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**

### **ุฅุฐุง ูุงู ุงูุชููู ุตุงูุญ:**
```
๐ [AUTH] ุงูุชุญูู ูู ุงูุชููู: { hasHeader: true, hasToken: true }
โ [AUTH] ุงูุชููู ุตุงูุญ: { userId: 1, roleId: 2, hospitalId: 11 }
๐ [HISTORY] ุงูุจุญุซ | hospitalId: 11 | roleId: 2
๐ ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงููุณุชุดูู 11 ูุจุฏูู ุงุญุชูุงุทู
โ ุชู ุงูุนุซูุฑ ุนูู 25 ูุชูุฌุฉ ูู ูุงุนุฏุฉ ุงููุณุชุดูู
```

### **ุฅุฐุง ูุงู ุงูุชููู ุบูุฑ ุตุงูุญ:**
```
๐ [AUTH] ุงูุชุญูู ูู ุงูุชููู: { hasHeader: false, hasToken: false }
โ [AUTH] ูุง ููุฌุฏ ุชููู
# ุฃู
โ [AUTH] ุงูุชููู ุบูุฑ ุตุงูุญ: jwt expired
```

## ๐ฏ **ุงูุฎุทูุงุช ุงูุณุฑูุนุฉ:**

### **1. ูุญุต ุณุฑูุน:**
```javascript
// ูู console ุงููุชุตูุญ:
console.log('ุงูุชููู:', localStorage.getItem('token'));
```

### **2. ุฅุฐุง ูู ููุฌุฏ ุชููู:**
```bash
# ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู
# ุงูุชุฃูุฏ ูู ุญูุธ ุงูุชููู
```

### **3. ุฅุฐุง ูุงู ุงูุชููู ููุฌูุฏ:**
```bash
# ูุฑุงูุจุฉ console ุงูุณูุฑูุฑ
# ุงูุจุญุซ ุนู ุฑุณุงุฆู AUTH
```

### **4. ุฅุฐุง ูุงู ุงูุชููู ุตุงูุญ:**
```bash
# ูุฑุงูุจุฉ ุฑุณุงุฆู HISTORY
# ุงูุจุญุซ ุนู fallback
```

---

## ๐ฏ **ุงูุฎูุงุตุฉ:**

**ุงููุดููุฉ ุงูุฃูุซุฑ ุงุญุชูุงูุงู:** ุงูุชููู ุบูุฑ ููุฌูุฏ ุฃู ููุชูู ุงูุตูุงุญูุฉ ุฃู ูุง ูุญุชูู ุนูู `hospitalId`.

**ุงูุญู ุงูุณุฑูุน:** ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู ูุงูุชุฃูุฏ ูู ุญูุธ ุงูุชููู ูู `localStorage`.

**ุงูุชุดุฎูุต:** ุงุณุชุฎุฏุงู ุฃุฏูุงุช ุงูุชุดุฎูุต ููุฑุงูุจุฉ console ุงููุชุตูุญ ูุงูุณูุฑูุฑ.
