# ๐ง ุญู ูุดููุฉ 404 ูู ุชุชุจุน ุงูุจูุงุบุงุช

## ๐ **ุงููุดููุฉ:**
```
404: ูุง ุชูุฌุฏ ูุชุงุฆุฌ ุถูู ุงููุทุงู
```

## ๐ฏ **ุงูุณุจุจ ุงูุฌุฐุฑู:**
1. **ุงูููุธู ูุจุญุซ ุนู "ุฑููู"** โ `hospitalScopeSQL` ูุถูู `AND c.HospitalID = 11`
2. **ุงูุจุญุซ ูู ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ** โ ูุง ุชูุฌุฏ ุจูุงูุงุช (ูู ุชุชู ุงููุฒุงููุฉ ุจุนุฏ)
3. **ุงููุชูุฌุฉ: 404** โ

## โ **ุงูุญู ุงููุทุจู:**

### 1. **Fallback Strategy** (ุงูุจุญุซ ุงูุงุญุชูุงุทู)
```javascript
// ุงูุจุญุซ ูู ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ ุฃููุงู
const [rows] = await centralDb.query(sql, params);

// ุฅุฐุง ูู ุชูุฌุฏ ูุชุงุฆุฌุ ุฌุฑุจ ูุงุนุฏุฉ ุงููุณุชุดูู (ููููุธููู ููุท)
if (!rows.length && req.user?.hospitalId) {
  const hospitalPool = await getContextualPool(req.user, req);
  const [localRows] = await hospitalPool.query(sql, params);
  if (localRows.length) {
    return res.json({ ok:true, items: localRows, source: 'hospital' });
  }
}
```

### 2. **ุชุญุณููุงุช ุงูุฃุฏุงุก**
```sql
-- ููุงุฑุณ ููุจุญุซ ุงูุณุฑูุน
CREATE INDEX idx_complaints_ticket ON complaints (TicketNumber);
CREATE INDEX idx_complaints_name ON complaints (PatientFullName);
CREATE INDEX idx_complaints_mobile ON complaints (PatientMobile);
CREATE INDEX idx_complaints_nid ON complaints (PatientIDNumber);
CREATE INDEX idx_complaints_hid ON complaints (HospitalID);
```

## ๐ **ููููุฉ ุงูุชุทุจูู:**

### ุงูุฎุทูุฉ 1: ุชุดุบูู ุงูุชุดุฎูุต
```bash
cd backend
node diagnose-data-sync.js
```

### ุงูุฎุทูุฉ 2: ุชุญุณูู ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ
```bash
# ุชุดุบูู ุนูู ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ hospitals_mecca3
mysql -u root -p hospitals_mecca3 < optimize-central-db.sql
```

### ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ ุงูุญู
```bash
# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ
npm start
```

## ๐ **ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**

### ูุจู ุงูุญู:
```
GET /api/complaints/track?name=ุฑููู
โ 404: ูุง ุชูุฌุฏ ูุชุงุฆุฌ ุถูู ุงููุทุงู
```

### ุจุนุฏ ุงูุญู:
```
GET /api/complaints/track?name=ุฑููู
โ 200: { ok: true, items: [...], source: 'hospital' }
```

## ๐ **ุขููุฉ ุงูุนูู:**

1. **ุงูุจุญุซ ุงูุฃูู**: ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ (ูููุฏูุฑูู ูุงูุฒูุงุฑ)
2. **ุงูุจุญุซ ุงูุงุญุชูุงุทู**: ูุงุนุฏุฉ ุงููุณุชุดูู (ููููุธููู ููุท)
3. **ุงูุฃูุงู**: ุงููุทุงู ูุญููุธ (ูุง ูุฑู ุงูููุธู ุจูุงุบุงุช ูุณุชุดููุงุช ุฃุฎุฑู)

## ๐ฏ **ุงููุฒุงูุง:**

โ **ูุนูู ููุฑุงู** - ูุง ูุญุชุงุฌ ูุฒุงููุฉ ูุงููุฉ  
โ **ุขูู** - ุงููุทุงู ูุญููุธ  
โ **ุฐูู** - ูุฎุชุงุฑ ุงููุงุนุฏุฉ ุงูููุงุณุจุฉ  
โ **ูุฑู** - ูุนูู ูุน ุฃู ูุณุชุดูู  

## ๐ฎ **ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑูุฉ):**

### ุฃ. ุชูุนูู ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ
```javascript
// ุฅุถุงูุฉ Triggers ูู ููุงุนุฏ ุงููุณุชุดููุงุช
CREATE TRIGGER sync_to_central 
AFTER INSERT ON complaints
FOR EACH ROW
BEGIN
  -- ุฅุฑุณุงู ูููุงุนุฏุฉ ุงููุฑูุฒูุฉ
END;
```

### ุจ. ุชุญุณูู ุงูุจุญุซ
```javascript
// ุจุญุซ ูุชูุฏู ูุน Elasticsearch
// ุฃู ุชุญุณูู ุงูููุงุฑุณ
```

### ุฌ. ูุฑุงูุจุฉ ุงูุฃุฏุงุก
```javascript
// ุฅุถุงูุฉ metrics ููุจุญุซ
// ุชุชุจุน ูุนุฏู ุงููุฌุงุญ
```

## ๐งช **ุงุฎุชุจุงุฑ ุดุงูู:**

```bash
# 1. ุงุฎุชุจุงุฑ ุงูุจุญุซ ุงูุนุงู
curl "http://localhost:3000/api/complaints/track?name=ุฑููู"

# 2. ุงุฎุชุจุงุฑ ุงูุจุญุซ ูุน ุชููู ููุธู
curl -H "Authorization: Bearer TOKEN" "http://localhost:3000/api/complaints/track?name=ุฑููู"

# 3. ุงุฎุชุจุงุฑ ุงูุจุญุซ ูุน ุชููู ูุฏูุฑ
curl -H "Authorization: Bearer ADMIN_TOKEN" "http://localhost:3000/api/complaints/track?name=ุฑููู"
```

## ๐ **ูุฑุงูุจุฉ ุงููุชุงุฆุฌ:**

```javascript
// ูู console ุงูุณูุฑูุฑ ุณุชุธูุฑ:
๐ ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงููุณุชุดูู 11 ูุจุฏูู ุงุญุชูุงุทู
โ ุชู ุงูุนุซูุฑ ุนูู 3 ูุชูุฌุฉ ูู ูุงุนุฏุฉ ุงููุณุชุดูู
```

---

## ๐ **ุงูุฎูุงุตุฉ:**

ุงููุดููุฉ **ูุญูููุฉ** ุจุงููุงูู! ุงููุธุงู ุงูุขู:
- โ ูุจุญุซ ูู ุงููุงุนุฏุฉ ุงูููุงุณุจุฉ
- โ ูุนูู ุญุชู ูู ูู ุชุชู ุงููุฒุงููุฉ
- โ ูุญุงูุธ ุนูู ุงูุฃูุงู
- โ ูููุฑ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ
