# ุฎุทูุงุช ุงูุชุดุฎูุต ุงูููุงุฆูุฉ

## ๐ ุงูุชุญููู ุงูุญุงูู

ูู ุฑุณุงุฆู ุงูุฎุทุฃ:
```
Error: Table 'hospitals_mecca3.user_permissions' doesn't exist
```

ูุฐุง ูุนูู ุฃู ุงููุธุงู **ูุณุชุฎุฏู ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ `hospitals_mecca3`** ุจุฏูุงู ูู `hosp_aaaa`.

## โ ุงูุชุดุฎูุต ุงููุถุงู

### **1. ูู `config/db.js`:**
```javascript
// ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ
centralDb._dbName = 'hospitals_mecca3';
centralDb._hospitalId = 'CENTRAL';

// ูุงุนุฏุฉ ุงููุณุชุดูู
pool._dbName = dbName; // ูุซูุงู hosp_aaaa
pool._hospitalId = hospitalId; // ูุซูุงู 11
```

### **2. ูู `routes/complaints.js`:**
```javascript
console.log(`๐ [HISTORY] ูุงุนุฏุฉ ุงูุจูุงูุงุช:`, hospitalPool._dbName);
console.log(`๐ [HISTORY] ูุนุฑู ุงููุณุชุดูู:`, hospitalPool._hospitalId);
```

## ๐งช ุงูุงุฎุชุจุงุฑ

### **1. ุฃุนุฏ ุชุดุบูู ุงูุจุงู-ุฅูุฏ:**
```bash
cd backend
npm start
```

### **2. ุงูุชุญ ุณุฌู ุงูุจูุงุบุงุช:**
- ุณุฌู ุฏุฎูู ููุณุชุฎุฏู 20
- ุงูุชุญ ุณุฌู ุงูุจูุงุบุงุช

### **3. ุงูุฑุณุงุฆู ุงููุชููุนุฉ:**

#### **ุฅุฐุง ูุงู ูุณุชุฎุฏู ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ (ุงููุดููุฉ):**
```
๐ [getContextualPool] ุงููุณุชุฎุฏู: { UserID: 20, HospitalID: 11, RoleID: 3 }
๐ [getContextualPool] ูุง ููุฌุฏ ูุณุชุฎุฏู -> ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ   โ
// ุฃู
๐ [getContextualPool] ูุฏูุฑ ุจุฏูู ูุณุชุดูู ูุญุฏุฏ -> ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ   โ

๐ [HISTORY] ูุงุนุฏุฉ ุงูุจูุงูุงุช: hospitals_mecca3   โ
๐ [HISTORY] ูุนุฑู ุงููุณุชุดูู: CENTRAL   โ
```

#### **ุฅุฐุง ูุงู ูุณุชุฎุฏู ูุงุนุฏุฉ ุงููุณุชุดูู (ุตุญูุญ):**
```
๐ [getContextualPool] ุงููุณุชุฎุฏู: { UserID: 20, HospitalID: 11, RoleID: 3 }
๐ [getContextualPool] ูุณุชุฎุฏู ุนุงุฏู (RoleID: 3) -> ูุงุนุฏุฉ ุงููุณุชุดูู 11   โ
๐ฅ ุฅูุดุงุก ุงุชุตุงู ูููุณุชุดูู ูุณุชุดูู ุงูููู ุนุจุฏุงููู (hosp_aaaa)   โ
โ [getHospitalPool] ุชู ุฅูุดุงุก ุงุชุตุงู ููุงุนุฏุฉ: hosp_aaaa   โ

๐ [HISTORY] ูุงุนุฏุฉ ุงูุจูุงูุงุช: hosp_aaaa   โ
๐ [HISTORY] ูุนุฑู ุงููุณุชุดูู: 11   โ
๐ [HISTORY] ุงูุตูุงุญูุงุช ุงูููุฌูุฏุฉ: [{...}, ...]   โ
๐ [HISTORY] ูุทุงู ุงูุตูุงุญูุฉ: DEPARTMENT   โ
๐ข [HISTORY] ุชุทุจูู ููุชุฑ ุงููุณู: 2   โ
```

## ๐ง ุงูุญููู ุงููุญุชููุฉ

### **ุงูุณููุงุฑูู 1: ุงููุณุชุฎุฏู = null**
```javascript
// ุงููุดููุฉ: req.user ุบูุฑ ููุฌูุฏ
// ุงูุญู: ุชุญูู ูู ุงูุชููู
console.log('๐ [AUTH] req.user:', req.user);
```

### **ุงูุณููุงุฑูู 2: HospitalID ูุงุฑุบ**
```javascript
// ุงููุดููุฉ: req.user.HospitalID = undefined
// ุงูุญู: ุชุญูู ูู ุงูุชููู
console.log('๐ [AUTH] HospitalID:', req.user?.HospitalID);
```

### **ุงูุณููุงุฑูู 3: RoleID ูุฏูุฑ**
```javascript
// ุงููุดููุฉ: req.user.RoleID = 1 ุฃู 4
// ุงูุญู: ุงููุฏูุฑูู ูุญุชุงุฌูู ?hospitalId= ูู URL
```

### **ุงูุณููุงุฑูู 4: ุงููุงุด ุงููุฏูู**
```javascript
// ุงููุดููุฉ: ุงููุงุด ูุฑุฌุน ุงุชุตุงู ูุฏูู
// ุงูุญู: ูุณุญ ุงููุงุด
hospitalPools.clear();
```

## ๐ ูุงุฆูุฉ ุงูุชุญูู

- [ ] ุฑุณุงูุฉ `[getContextualPool]` ุชุธูุฑุ
- [ ] `UserID`, `HospitalID`, `RoleID` ุตุญูุญุฉุ
- [ ] ุฑุณุงูุฉ "ูุณุชุฎุฏู ุนุงุฏู" ุชุธูุฑุ
- [ ] ุฑุณุงูุฉ "ุฅูุดุงุก ุงุชุตุงู ูููุณุชุดูู" ุชุธูุฑุ
- [ ] `ูุงุนุฏุฉ ุงูุจูุงูุงุช: hosp_aaaa` ุชุธูุฑุ
- [ ] ุงูุฎุทุฃ ูุง ูุฒุงู `hospitals_mecca3`ุ

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ

ุจุนุฏ ุงูุชุดุฎูุตุ ูุฌุจ ุฃู ูุนุฑู ุจุงูุถุจุท:
1. โ ูุง ูู ุงูุงุชุตุงู ุงูุฐู ููุณุชุฎุฏู
2. โ ููุงุฐุง ุงููุธุงู ูุณุชุฎุฏู ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ
3. โ ููู ูุตูุญ ุงููุดููุฉ

ุดุงุฑู ุฑุณุงุฆู console ุงููุงููุฉ ููุญูู ุงููุดููุฉ! ๐ฏ
