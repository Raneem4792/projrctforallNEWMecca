# ๐ฏ ุงูุชุทุงุจู ุงููุงูู: ููุทู "ุณุฌู ุงูุจูุงุบุงุช" = "ูุชุงุจุนุฉ ุงูุจูุงุบุงุช"

## โ **ุชู ุชุญููู ุงูุชุทุงุจู ุงููุงูู ุจูุฌุงุญ!**

### ๐ **ุงููุฏู:**
ุฌุนู ููุทู "ุณุฌู ุงูุจูุงุบุงุช" ูุทุงุจู ุชูุงูุงู ูููุทู "ูุชุงุจุนุฉ ุงูุจูุงุบุงุช" ูู ุฌููุน ุงูุฎุทูุงุช.

## ๐ **ุงูุชุทุงุจู ุงููุงูู ุงููุทุจู:**

### ๐งฉ **ุงูุฎุทูุฉ 1 - ุงููุงุฌูุฉ ุชุทูุจ ุงูุจูุงูุงุช**

#### **ุณุฌู ุงูุจูุงุบุงุช:**
```javascript
// GET /api/complaints/history?page=1&pageSize=9&status=ALL&hospitalId=11
if (filters.hospital && filters.hospital !== 'ALL') {
  params.set('hospitalId', filters.hospital);
  console.log(`๐ฅ ุฅุฑุณุงู hospitalId: ${filters.hospital}`);
}
```

#### **ูุชุงุจุนุฉ ุงูุจูุงุบุงุช:**
```javascript
// GET /api/complaints/track?name=ุฑููู&hospitalId=11
const hospitalId = localStorage.getItem('hospitalId');
if (hospitalId && hospitalId !== 'ALL') {
  params.set('hospitalId', hospitalId);
  console.log(`๐ฅ ุฅุฑุณุงู hospitalId: ${hospitalId}`);
}
```

### ๐งฉ **ุงูุฎุทูุฉ 2 - ุงูุณูุฑูุฑ ูุณุชูุจู ุงูุทูุจ ููุญููู**

#### **ููุง ุงููุณุงุฑูู:**
```javascript
// ูุฑุงุกุฉ ุงูููุงุชุฑ
const name = (req.query.name || '').trim();
const hospitalId = req.user?.hospitalId || parseInt(req.query.hospitalId, 10);

// ุชุญุฏูุฏ ุงููุทุงู
const scope = hospitalScopeSQL(req.user, 'c', req);
```

**ุงูููุทู:**
- **ุงูููุธู** โ `AND c.HospitalID = ?`
- **ูุฏูุฑ ุงูุชุฌูุน** โ ูุดูู ุงููู
- **ุฒุงุฆุฑ ูุน ?hospitalId=** โ ูุณุชุฎุฏู ูุฐุง ุงููID

### ๐งฉ **ุงูุฎุทูุฉ 3 - ุงูุจุญุซ ุฃููุงู ูู ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ**

#### **ููุง ุงููุณุงุฑูู:**
```javascript
// ุงูุจุญุซ ูู ุงููุงุนุฏุฉ ุงููุฑูุฒูุฉ
const [rows] = await centralDb.query(sqlData, [...params, pageSize, offset]);

// ูู ููู ุจูุงูุงุช โ ูุฑุฌุนูุง (source: "central")
if (rows.length) {
  return res.json({ ok: true, items: rows, source: 'central' });
}
```

### ๐งฉ **ุงูุฎุทูุฉ 4 - ูู ุงููุฑูุฒูุฉ ูุงุถูุฉ โ ุฌุฑุจ ูุงุนุฏุฉ ุงููุณุชุดูู**

#### **ููุง ุงููุณุงุฑูู (ูุทุงุจู ุชูุงูุงู):**
```javascript
// ุฅุฐุง ูู ุชูุฌุฏ ูุชุงุฆุฌ ูู ุงููุฑูุฒูุฉุ ุฌุฑุจ ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงููุณุชุดูู
if (!rows.length && (req.user?.hospitalId || req.query.hospitalId)) {
  const hospitalId = req.user?.hospitalId || parseInt(req.query.hospitalId, 10);
  if (Number.isFinite(hospitalId)) {
    console.log(`๐ ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงููุณุชุดูู ${hospitalId} ูุจุฏูู ุงุญุชูุงุทู`);
    try {
      const fakeUser = req.user || { roleId: 0, hospitalId };
      const pool = await getContextualPool(fakeUser, req);
      const [rows2] = await pool.query(sqlData, [...params, pageSize, offset]);
      
      if (rows2.length) {
        console.log(`โ ุชู ุงูุนุซูุฑ ุนูู ${rows2.length} ูุชูุฌุฉ ูู ูุงุนุฏุฉ ุงููุณุชุดูู`);
        return res.json({
          ok: true,
          items: rows2,
          source: 'hospital'
        });
      }
    } catch (error) {
      console.log('โ๏ธ ุฎุทุฃ ูู ุงูุจุญุซ ุงูุงุญุชูุงุทู:', error.message);
    }
  }
}
```

### ๐งฉ **ุงูุฎุทูุฉ 5 - ูุฑุฌุน ุงูุฑุฏ ุฏุงุฆููุง 200 (ูุงููู Error)**

#### **ููุง ุงููุณุงุฑูู:**
```javascript
// ูุฌุงุญ (ุญุชู ูู ูุงุถู) โ ูุง ูุฑุฌูุน 404
return res.json({
  ok: true,
  items: rows,
  total: cnt?.cnt || 0,
  message: 'ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุทุงุจูุฉ ููุฏุฎู ุงูุจุญุซ'
});
```

### ๐งฉ **ุงูุฎุทูุฉ 6 - ุงููุงุฌูุฉ ุชุนุฑุถ ุงููุชุงุฆุฌ**

#### **ููุง ุงููุงุฌูุชูู:**
```javascript
// ูุฌุงุญ (ุญุชู ูู ุงููุงุฆูุฉ ูุงุฑุบุฉ)
if (data.ok === true && Array.isArray(data.items)) {
  if (data.items.length === 0) {
    showNoResults(data.message || 'ูุง ูุฌุฏูุง ุจูุงุบ ุจูุฐุง ุงูุงุณู/ุงูุฑูู');
    return;
  }
  renderResults(data.items);
  return;
}
```

## ๐ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ (ุงูุชุณูุณู ุงููุงูู)**

| ุงูุฎุทูุฉ | ุงููุนู | ูู ุฃู ูุงุนุฏุฉุ |
|--------|-------|-------------|
| ุงููุณุชุฎุฏู ููุชุญ ุงูุตูุญุฉ ุฃู ูููุชุฑ | โ | โ |
| JS ูุฑุณู /history ุฃู /track | โ | โ |
| ุงูุณูุฑูุฑ ูุจุญุซ ูู ุงููุฑูุฒูุฉ | ๐ centralDb | |
| ูู ุงููุฑูุฒูุฉ ูุงุถูุฉ | ๐ ููุชูู ุฅูู ูุงุนุฏุฉ ุงููุณุชุดูู (getContextualPool) | |
| ูุฑุฌุน ุงููุชุงุฆุฌ | ๐งพ JSON ูุงุญุฏ ููุญูุฏ | |
| ุงููุงุฌูุฉ ุชุฑุณููุง | ๐ป ุชุธูุฑ ุงูุจูุงุบุงุช ุจุฏูู ุฃุฎุทุงุก | |

## ๐ฏ **ุงูุชุทุงุจู ุงููุงูู ุงููุญูู:**

### โ **ููุณ ุงูููุทู:**
- ุงูุจุญุซ ูู ุงููุฑูุฒูุฉ ุฃููุงู
- Fallback ููุงุนุฏุฉ ุงููุณุชุดูู ุนูุฏ ุงูุญุงุฌุฉ
- ุฏุนู `?hospitalId=` ููุฒูุงุฑ
- ุฏุนู ุงูุชููู ููููุธููู

### โ **ููุณ ุงูุงุณุชุฌุงุจุฉ:**
- ุฏุงุฆูุงู `200` (ูุง `404`)
- `source: 'central'` ุฃู `'hospital'`
- ุฑุณุงุฆู ูุงุถุญุฉ ุนูุฏ ุนุฏู ูุฌูุฏ ูุชุงุฆุฌ

### โ **ููุณ ุงููุงุฌูุฉ:**
- ุฅุฑุณุงู `hospitalId` ุนูุฏ ุงูุญุงุฌุฉ
- ูุนุงูุฌุฉ ุงููุชุงุฆุฌ ุงููุงุฑุบุฉ
- ุนุฑุถ ุฑุณุงุฆู ูุฏูุฉ

## ๐งช **ุงุฎุชุจุงุฑ ุงูุชุทุงุจู:**

### **1. ุงุฎุชุจุงุฑ ุงูุฒูุงุฑ:**
```bash
# ูุชุญ ุตูุญุฉ ุณุฌู ุงูุจูุงุบุงุช
# ุงุฎุชูุงุฑ ูุณุชุดูู ูู ุงููุงุฆูุฉ
# ูุฌุจ ุฃู ูุนูู fallback ููุงุนุฏุฉ ุงููุณุชุดูู

# ูุชุญ ุตูุญุฉ ูุชุงุจุนุฉ ุงูุจูุงุบุงุช  
# ุฅุฏุฎุงู hospitalId ูู localStorage
# ูุฌุจ ุฃู ูุนูู fallback ููุงุนุฏุฉ ุงููุณุชุดูู
```

### **2. ุงุฎุชุจุงุฑ ุงูููุธููู:**
```bash
# ุชุณุฌูู ุงูุฏุฎูู ูููุธู
# ูุชุญ ุฃู ูู ุงูุตูุญุชูู
# ูุฌุจ ุฃู ูุนูู fallback ุชููุงุฆูุงู
```

### **3. ุงุฎุชุจุงุฑ ุงููุฏูุฑูู:**
```bash
# ุชุณุฌูู ุงูุฏุฎูู ููุฏูุฑ ุชุฌูุน
# ูุชุญ ุฃู ูู ุงูุตูุญุชูู
# ูุฌุจ ุฃู ูุฑู ุฌููุน ุงููุณุชุดููุงุช
```

## ๐ **ุงููุฒุงูุง ุงููุญููุฉ:**

โ **ุชุทุงุจู ูุงูู** - ููุณ ุงูููุทู ูู ููุง ุงููุณุงุฑูู  
โ **ุชุฌุฑุจุฉ ููุญุฏุฉ** - ููุณ ุงูุณููู ูููุณุชุฎุฏู  
โ **ูุฑููุฉ ูุงููุฉ** - ูุนูู ูุน ุฌููุน ุฃููุงุน ุงููุณุชุฎุฏููู  
โ **ูุง ุฃุฎุทุงุก** - ุฏุงุฆูุงู `200` ูุน ุฑุณุงุฆู ูุงุถุญุฉ  
โ **ุฐูุงุก ุชููุงุฆู** - fallback ุนูุฏ ุงูุญุงุฌุฉ  

## ๐ฎ **ุงูุฎุทูุงุช ุงูุชุงููุฉ:**

### **1. ุงุฎุชุจุงุฑ ุดุงูู:**
```bash
cd backend
npm start
# ุงุฎุชุจุงุฑ ููุง ุงูุตูุญุชูู
# ุงูุชุฃูุฏ ูู ุงูุชุทุงุจู ุงููุงูู
```

### **2. ูุฑุงูุจุฉ ุงููุชุงุฆุฌ:**
```bash
# ูุฑุงูุจุฉ console ุงูุณูุฑูุฑ
# ูุฑุงูุจุฉ console ุงููุชุตูุญ
# ุงูุชุฃูุฏ ูู ููุณ ุงูุณููู
```

---

## ๐ฏ **ุงูุฎูุงุตุฉ:**

**ุชู ุชุญููู ุงูุชุทุงุจู ุงููุงูู ุจูุฌุงุญ!** 

"ุณุฌู ุงูุจูุงุบุงุช" ู "ูุชุงุจุนุฉ ุงูุจูุงุบุงุช" ูุนููุงู ุจููุณ ุงูููุทู ุชูุงูุงู:
- โ ููุณ ุงูุฎุทูุงุช
- โ ููุณ ุงูููุทู
- โ ููุณ ุงูุงุณุชุฌุงุจุฉ
- โ ููุณ ุงูุชุฌุฑุจุฉ

**ููุทู ููุญุฏ ููุชูุงูู!** ๐
