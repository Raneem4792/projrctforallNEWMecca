
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>التقارير والإحصائيات - تجمع مكة المكرمة الصحي</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-funnel@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-box-and-violin-plot@3"></script>
  <!-- نعيد استخدام نفس ستايلات الداشبورد عشان الشكل يظل موحّد -->
  <link rel="stylesheet" href="../public/assets/css/styles.css" />
  <link rel="stylesheet" href="dashboard.css" />
  
  <!-- Bootstrap Icons للرسائل التوضيحية -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />
  
  <style>
    /* تنسيق الرسالة التوضيحية */
    .alert {
      padding: 12px 16px;
      margin-bottom: 16px;
      border: 1px solid transparent;
      border-radius: 8px;
      font-family: 'Tajawal', sans-serif;
    }
    
    .alert-info {
      color: #0c5460;
      background-color: #d1ecf1;
      border-color: #bee5eb;
    }
    
    .alert-warning {
      color: #856404;
      background-color: #fff3cd;
      border-color: #ffeaa7;
    }
    
    .alert i {
      font-size: 16px;
    }
    
    /* تنسيق dropdowns المعطلة */
    select:disabled {
      background-color: #f8f9fa;
      cursor: not-allowed;
    }
  </style>
</head>
<body class="bg-gray-50">

  <!-- نفس هيدر موقعك (لو عندك كومبوننت مشترك حطه هنا) -->
  <header id="navbar" class="fixed w-full top-0 z-50 navbar-scroll" style="background-color:#002B5B;">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <img src="../public/assets/img/logo3.png" alt="شعار تجمع مكة المكرمة الصحي" class="h-16 w-auto">
        </div>
        <nav class="hidden md:flex items-center space-x-reverse space-x-8">
          <a href="../index/index.html" class="text-white hover:text-blue-200 transition-colors">الرئيسية</a>
          <a href="dashboard.html" class="text-white hover:text-blue-200 transition-colors">لوحة التحكم</a>
          <a href="hospitals.html" class="text-white hover:text-blue-200 transition-colors">المستشفيات</a>
          <a href="reports.html" class="text-white hover:text-blue-200 transition-colors font-bold underline">التقارير والإحصائيات</a>
          <a href="../public/profile.html" id="nav-profile" class="text-white hover:text-blue-200 transition-colors hidden">ملفي</a>
          <a href="../index/about-system.html" class="text-white hover:text-blue-200 transition-colors">حول النظام</a>
          <a href="../index/help.html" class="text-white hover:text-blue-200 transition-colors">المساعدة</a>
          <a href="../index/contact.html" class="text-white hover:text-blue-200 transition-colors">اتصل بنا</a>
        </nav>
        <button class="md:hidden text-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button>
      </div>
    </div>
  </header>

  <main class="pt-20">
    <section class="reports-header pt-8 pb-4 bg-white">
      <div class="container mx-auto px-4">
        <div class="text-center mb-8">
          <h1 class="text-4xl font-bold mb-2" style="color:#002B5B;">التقارير والإحصائيات</h1>
          <div class="w-32 h-1 mx-auto mb-4" style="background:linear-gradient(90deg,#004A9F,#0FA47A)"></div>
          <p class="text-xl text-gray-600 max-w-2xl mx-auto">تحليل شامل لأداء البلاغات</p>
        </div>

        <!-- KPI Strip (مضغوط وفوق) -->
        <div class="grid md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6">
          <!-- إجمالي البلاغات -->
          <div class="bg-white rounded-xl p-3 shadow border border-gray-100 flex items-center gap-3" data-perm="REPORTS_CARD_TOTALS">
            <div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center">
              <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M3 3h18M3 9h18M3 15h18M3 21h18"/>
              </svg>
            </div>
            <div>
              <div class="text-xs text-gray-500">إجمالي البلاغات</div>
              <div id="kpi-total" class="text-lg font-bold" style="color:#002B5B">0</div>
            </div>
          </div>

          <!-- مفتوحة -->
          <div class="bg-white rounded-xl p-3 shadow border border-gray-100 flex items-center gap-3" data-perm="REPORTS_CARD_OPEN">
            <div class="w-8 h-8 rounded-lg bg-amber-500 flex items-center justify-center">
              <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3M12 2a10 10 0 100 20 10 10 0 000-20z"/>
              </svg>
            </div>
            <div>
              <div class="text-xs text-gray-500">بلاغات مفتوحة</div>
              <div id="kpi-open" class="text-lg font-bold" style="color:#002B5B">0</div>
            </div>
          </div>

          <!-- مغلقة -->
          <div class="bg-white rounded-xl p-3 shadow border border-gray-100 flex items-center gap-3" data-perm="REPORTS_CARD_CLOSED">
            <div class="w-8 h-8 rounded-lg bg-emerald-600 flex items-center justify-center">
              <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <div>
              <div class="text-xs text-gray-500">بلاغات مغلقة</div>
              <div id="kpi-closed" class="text-lg font-bold" style="color:#002B5B">0</div>
            </div>
          </div>

          <!-- حرجة -->
          <div class="bg-white rounded-xl p-3 shadow border border-gray-100 flex items-center gap-3" data-perm="REPORTS_CARD_URGENT">
            <div class="w-8 h-8 rounded-lg bg-red-600 flex items-center justify-center">
              <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
              </svg>
            </div>
            <div>
              <div class="text-xs text-gray-500">بلاغات حرجة</div>
              <div id="kpi-critical" class="text-lg font-bold" style="color:#002B5B">0</div>
            </div>
          </div>

          <!-- عدد المستشفيات -->
          <div class="bg-white rounded-xl p-3 shadow border border-gray-100 flex items-center gap-3" data-perm="REPORTS_CARD_HOSPITALS">
            <div class="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center">
              <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M3 7l9-4 9 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4V7zM9 21V9h6v12"/>
              </svg>
            </div>
            <div>
              <div class="text-xs text-gray-500">عدد المستشفيات</div>
              <div id="kpi-hospitals" class="text-lg font-bold" style="color:#002B5B">0</div>
            </div>
          </div>

          <!-- الالتزام بالـ SLA (اختياري) -->
          <div class="bg-white rounded-xl p-3 shadow border border-gray-100 flex items-center gap-3" data-perm="REPORTS_CARD_SLA">
            <div class="w-8 h-8 rounded-lg bg-sky-600 flex items-center justify-center">
              <svg class="w-4 h-4 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <div>
              <div class="text-xs text-gray-500">الالتزام بالـ SLA</div>
              <div id="kpi-sla" class="text-lg font-bold" style="color:#002B5B">—</div>
            </div>
          </div>
        </div>

        <!-- الوضع في كل مستشفى - في الأعلى -->
        <div class="mb-12" data-perm="REPORTS_CHART_BY_HOSPITAL_TYPE">
          <div class="card-hover bg-white rounded-2xl p-5 shadow-xl border border-gray-100">
            <div class="flex items-center mb-6">
              <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-pink-600 rounded-xl flex items-center justify-center ml-4">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 3h18M3 7h18M3 11h18M3 15h18M3 19h18" />
                </svg>
              </div>
              <h3 class="text-2xl font-bold" style="color:#002B5B;">الوضع في كل مستشفى</h3>
            </div>
            <div style="height:300px">
              <canvas id="hospitalChart"></canvas>
            </div>
          </div>
        </div>

        <!-- الرسوم البيانية الأخرى - في الأسفل -->
        <div class="grid lg:grid-cols-2 gap-6">
          <!-- اتجاه البلاغات -->
          <div class="card-hover bg-white rounded-2xl p-5 shadow-xl border border-gray-100" data-perm="REPORTS_CHART_TREND_6M">
            <div class="flex items-center mb-6">
              <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center ml-4">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2z"/></svg>
              </div>
              <h3 class="text-2xl font-bold" style="color:#002B5B;">اتجاه البلاغات (آخر 6 أشهر)</h3>
            </div>
            <div style="height:260px"><canvas id="reportsChart"></canvas></div>
          </div>

          <!-- توزيع الحالات -->
          <div class="card-hover bg-white rounded-2xl p-5 shadow-xl border border-gray-100" data-perm="REPORTS_CHART_STATUS_DISTRIBUTION">
            <div class="flex items-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center ml-4">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/></svg>
                </div>
                <h3 class="text-2xl font-bold" style="color:#002B5B;">توزيع حالات البلاغات</h3>
              </div>
              <div style="height:260px"><canvas id="statusChart"></canvas></div>
            </div>

            <!-- نسبة البلاغات الحرجة -->
            <div class="card-hover bg-white rounded-2xl p-5 shadow-xl border border-gray-100 lg:col-span-2" data-perm="REPORTS_CHART_URGENT_PERCENT">
              <div class="flex items-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-orange-500 rounded-xl flex items-center justify-center ml-4">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 9v2m0 4h.01M12 5a7 7 0 00-7 7v1a7 7 0 0014 0v-1a7 7 0 00-7-7z" />
                  </svg>
                </div>
                <h3 class="text-2xl font-bold" style="color:#002B5B;">نسبة البلاغات الحرجة في كل مستشفى</h3>
              </div>
              <div style="height:300px"><canvas id="criticalRatioChart"></canvas></div>
            </div>



            <!-- عدد البلاغات لكل قسم — حسب المستشفى -->
            <div class="card-hover bg-white rounded-2xl p-5 shadow-xl border border-gray-100 lg:col-span-2" data-perm="REPORTS_CHART_BY_DEPARTMENT">
              <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                  <div class="w-12 h-12 bg-gradient-to-br from-sky-500 to-blue-600 rounded-xl flex items-center justify-center ml-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 10h12M4 14h8M4 18h6" />
                    </svg>
                  </div>
                  <h3 class="text-2xl font-bold" style="color:#002B5B;">عدد البلاغات لكل قسم</h3>
                </div>

                <!-- مُبدّل المستشفى -->
                <div class="flex items-center gap-2">
                  <label for="deptCountHospital" class="text-sm text-gray-600">اختاري المستشفى:</label>
                  <select id="deptCountHospital" class="rounded-lg border-gray-300 text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <!-- يُعبّأ ديناميكياً -->
                  </select>
                </div>
              </div>

              <div style="height:320px"><canvas id="deptCountChart"></canvas></div>
              <p class="text-sm text-gray-500 mt-3">القيم تمثل إجمالي البلاغات المسجّلة في كل قسم داخل المستشفى المحدد.</p>
            </div>

            <!-- أكثر الموظفين تكرّرًا في البلاغات — حسب المستشفى -->
            <div class="card-hover bg-white rounded-2xl p-5 shadow-xl border border-gray-100 lg:col-span-2" data-perm="REPORTS_CHART_TOP_EMPLOYEES">
              <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                  <div class="w-12 h-12 bg-gradient-to-br from-fuchsia-600 to-pink-600 rounded-xl flex items-center justify-center ml-4">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 20h5v-2a4 4 0 00-4-4h-1M9 20H4v-2a4 4 0 014-4h1m4-8a4 4 0 110 8 4 4 0 010-8z" />
                    </svg>
                  </div>
                  <h3 class="text-2xl font-bold" style="color:#002B5B;">الموظفون الأكثر تكرّرًا في البلاغات</h3>
                </div>

                <!-- مُبدّل المستشفى + اختيار Top N -->
                <div class="flex items-center gap-3">
                  <label for="topEmployeesHospital" class="text-sm text-gray-600">المستشفى:</label>
                  <select id="topEmployeesHospital" class="rounded-lg border-gray-300 text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <!-- يُعبّأ ديناميكياً -->
                  </select>

                  <label for="topEmployeesCount" class="text-sm text-gray-600">Top:</label>
                  <select id="topEmployeesCount" class="rounded-lg border-gray-300 text-sm px-2 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="5">5</option>
                    <option value="8" selected>8</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                  </select>
                </div>
              </div>

              <div style="height:320px"><canvas id="topEmployeesChart"></canvas></div>
              <p class="text-sm text-gray-500 mt-3">
                يُعرَض أعلى الموظفين تكرّرًا في البلاغات داخل المستشفى المحدّد (بالعدد). الترتيب تنازلي.
              </p>
            </div>
          </div>
      </div>
    </section>
  </main>

  <!-- Footer - التذييل -->
  <footer class="bg-gray-900 text-white py-14">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-3 gap-8">
        <!-- Column 1 - العمود الأول -->
        <div>
          <div class="flex items-center space-x-reverse space-x-3 mb-4">
            <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
              </svg>
            </div>
            <div>
              <div class="font-bold">تجمع مكة الصحي</div>
              <div class="text-sm text-gray-300">نظام البلاغات</div>
            </div>
          </div>
          <p class="text-gray-300 text-sm">منصة رسمية لتقديم ومتابعة البلاغات</p>
        </div>

        <!-- Column 2 - العمود الثاني -->
        <div>
          <h3 class="font-bold mb-4">روابط سريعة</h3>
          <ul class="space-y-2 text-sm">
            <li><a href="../index/index.html" class="text-gray-300 hover:text-white hover:underline transition-colors">الرئيسية</a></li>
            <li><a href="../public/complaints/submit/submit-complaint.html" class="text-gray-300 hover:text-white hover:underline transition-colors">تقديم بلاغ</a></li>
            <li><a href="../public/complaints/track/track-complaint.html" class="text-gray-300 hover:text-white hover:underline transition-colors">متابعة بلاغ</a></li>
            <li><a href="../index/help.html" class="text-gray-300 hover:text-white hover:underline transition-colors">الأسئلة الشائعة</a></li>
          </ul>
        </div>

        <!-- Column 3 - العمود الثالث -->
        <div>
          <h3 class="font-bold mb-4">معلومات التواصل</h3>
          <div class="space-y-2 text-sm text-gray-300">
            <div class="flex items-baseline">
              <svg class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
              <span>رقم الدعم: 0559735137</span>
            </div>
            <div class="flex items-baseline">
              <svg class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
              <span>رقم الدعم: 0542282550</span>
            </div>
            <div class="flex items-baseline">
              <svg class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              <span>support@makkahhealth.gov.sa</span>
            </div>
            <div class="flex items-baseline">
              <svg class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span>ساعات العمل: 24/7</span>
            </div>
          </div>
        </div>
      </div>

      <div class="border-t border-gray-700 mt-8 pt-8 text-center text-sm text-gray-300">
        © 2025 تجمع مكة المكرمة الصحي – جميع الحقوق محفوظة
      </div>
    </div>
  </footer>

  <script src="reports.js"></script>
</body>
</html>
