<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ù…Ø´Ø±ÙˆØ¹ ØªØ­Ø³ÙŠÙ†ÙŠ - 937</title>

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme:{ extend:{ colors:{ primary:'#002B5B' } } } }
  </script>

  <!-- Tajawal -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Tajawal',system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    .custom-select{
      background-color:#f8fafc;
      border-radius:0.75rem;
      border:1px solid #d1d5db;
      padding:0.75rem;
      transition:border-color .2s ease, box-shadow .2s ease;
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%23002B5B' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:left 1rem center;
      padding-left:2.5rem;
      direction:rtl;
    }
    .custom-select:focus{
      border-color:#2563eb;
      box-shadow:0 0 0 3px rgba(37,99,235,.15);
      outline:none;
    }
    .custom-select option{
      background-color:#fff;
      color:#1f2937;
    }
  </style>

  <!-- Ù‡ÙˆÙŠØ© Ù…Ø´Ø±ÙˆØ¹Ùƒ -->
  <link rel="stylesheet" href="../hospital/hospital.css">
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Header -->
  <header id="navbar" class="fixed w-full top-0 z-50 navbar-scroll" style="background-color: #002B5B;">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <img src="../../public/assets/img/logo3.png" alt="Ø´Ø¹Ø§Ø± ØªØ¬Ù…Ø¹ Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø§Ù„ØµØ­ÙŠ" class="h-16 w-auto">
        </div>
        <nav class="hidden md:flex items-center space-x-reverse space-x-8">
          <a href="../../index/index.html" class="text-white hover:text-blue-200 transition-colors">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
          <a href="../dashboard.html" class="text-white hover:text-blue-200 transition-colors">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
          <a href="./list.html" class="text-white hover:text-blue-200 transition-colors">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØªØ­Ø³ÙŠÙ†ÙŠØ©</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="pt-24 min-h-screen pb-12">
    <div class="max-w-4xl mx-auto px-4 md:px-6 lg:px-8">

      <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø¹ Badge -->
      <div class="mb-8">
        <div class="flex items-center gap-3 mb-3">
          <span class="px-4 py-1.5 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold">Ù…Ø´Ø±ÙˆØ¹ 937</span>
        </div>
        <h1 class="text-3xl md:text-4xl font-extrabold text-primary mb-2">
          Ù…Ø´Ø±ÙˆØ¹ ØªØ­Ø³ÙŠÙ†ÙŠ Ù…Ù† Ù…Ø±ÙƒØ² 937
        </h1>
        <p class="text-gray-600">
          Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ ØªØ­Ø³ÙŠÙ†ÙŠ Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ø¨Ù„Ø§Øº Ù…Ù† Ù…Ø±ÙƒØ² Ø§Ù„Ø§ØªØµØ§Ù„ 937
        </p>
      </div>

      <!-- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
      <form id="projectForm" class="bg-white rounded-2xl shadow-lg p-6 md:p-8 space-y-6">

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ­Ø³ÙŠÙ†ÙŠ -->
        <div class="border-b border-gray-200 pb-6">
          <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
            <svg class="w-6 h-6 ml-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ­Ø³ÙŠÙ†ÙŠ
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <!-- Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ <span class="text-red-500">*</span>
              </label>
              <select id="hospitalSelect" required
                      class="custom-select w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</option>
              </select>
            </div>

            <!-- Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ <span class="text-red-500">*</span>
              </label>
              <select id="projectCategory" required
                      class="custom-select w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</option>
                <option value="ÙˆØ²Ø§Ø±ÙŠ">Ù…Ø´Ø±ÙˆØ¹ ÙˆØ²Ø§Ø±ÙŠ</option>
                <option value="Ø§Ù„Ù‚Ø§Ø¨Ø¶Ø©">Ù…Ø´Ø±ÙˆØ¹ Ù„Ù„ØµØ­Ø© Ø§Ù„Ù‚Ø§Ø¨Ø¶Ø©</option>
                <option value="20/80">Ù…Ø´Ø±ÙˆØ¹ 20/80</option>
                <option value="20/25">Ù…Ø´Ø±ÙˆØ¹ 20/25</option>
                <option value="Ø£Ø®Ø±Ù‰">Ù…Ø´Ø±ÙˆØ¹ Ø£Ø®Ø±Ù‰</option>
              </select>
            </div>

            <!-- Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ <span class="text-red-500">*</span>
              </label>
              <select id="mainType" required
                      class="custom-select w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„ÙØ±Ø¹ÙŠ <span class="text-red-500">*</span>
              </label>
              <select id="subType" required
                      class="custom-select w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„ÙØ±Ø¹ÙŠ</option>
              </select>
            </div>
          </div>

          <!-- Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ - Ø£Ø®Ø±Ù‰ -->
          <div id="projectCategoryOtherContainer" class="mt-4 hidden">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Ø§Ø°ÙƒØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (ÙÙŠ Ø­Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø£Ø®Ø±Ù‰) <span class="text-red-500">*</span>
            </label>
            <input type="text" id="projectCategoryOther"
                   class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   placeholder="Ø£Ø¯Ø®Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù‡Ù†Ø§">
          </div>

          <!-- Ø³Ø¨Ø¨ ØªØ£Ø«Ø± Ø§Ù„Ù…Ø¤Ø´Ø± -->
          <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Ø³Ø¨Ø¨ ØªØ£Ø«Ø± Ø§Ù„Ù…Ø¤Ø´Ø± <span class="text-red-500">*</span>
            </label>
            <textarea id="impactReason" required rows="3"
                      class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="Ø§Ø´Ø±Ø­ Ø³Ø¨Ø¨ ØªØ£Ø«Ø± Ø§Ù„Ù…Ø¤Ø´Ø± Ø£Ùˆ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªÙŠ Ø£Ø«Ø±Øª Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬"></textarea>
          </div>

          <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
          <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ <span class="text-red-500">*</span>
            </label>
            <input type="text" id="projectName" required
                   class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ­Ø³ÙŠÙ†ÙŠ">
          </div>

          <!-- ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ -->
          <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ <span class="text-red-500">*</span>
            </label>
            <textarea id="projectDescription" required rows="4"
                      class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="Ø§Ø´Ø±Ø­ ÙÙƒØ±Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ­Ø³ÙŠÙ†ÙŠ ÙˆØ§Ù„Ø¬Ù‡ÙˆØ¯ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„ØªÙ†ÙÙŠØ°Ù‡"></textarea>
          </div>

          <!-- Ø§Ù„Ù‡Ø¯Ù -->
          <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Ø§Ù„Ù‡Ø¯Ù Ù…Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ <span class="text-red-500">*</span>
            </label>
            <textarea id="aimStatement" required rows="3"
                      class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="Ù…Ø§ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† ØªÙ†ÙÙŠØ° Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ­Ø³ÙŠÙ†ÙŠØŸ"></textarea>
          </div>

          <!-- Ù…Ø¹Ø§ÙŠÙŠØ± SMART -->
          <div class="bg-white border border-gray-200 rounded-2xl shadow-sm mt-8">
            <div class="px-6 py-5 border-b border-gray-200">
              <h3 class="text-xl font-bold text-primary mb-2">Ù…Ø¹Ø§ÙŠÙŠØ± SMART Ù„Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ­Ø³ÙŠÙ†ÙŠ</h3>
              <p class="text-gray-600 text-sm">
                Ø­Ø¯Ø¯ÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ­Ø³ÙŠÙ†ÙŠ.
              </p>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full text-sm text-right">
                <thead class="bg-gray-50 text-gray-700">
                  <tr>
                    <th class="px-6 py-3 font-semibold">Ø§Ù„Ù…Ø¹ÙŠØ§Ø±</th>
                    <th class="px-6 py-3 font-semibold">Ø§Ù„ÙˆØµÙ</th>
                    <th class="px-6 py-3 font-semibold text-center">Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù‡Ø¯ÙØŸ</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                  <tr>
                    <td class="px-6 py-4 font-semibold text-gray-800">Ù…Ø­Ø¯Ø¯ (Specific)</td>
                    <td class="px-6 py-4 text-gray-600">ÙˆØµÙ Ø§Ù„Ù‡Ø¯Ù Ø¨ÙˆØ¶ÙˆØ­ ÙˆØ¨Ø´ÙƒÙ„ Ù…Ø­Ø¯Ø¯.</td>
                    <td class="px-6 py-4 text-center">
                      <input id="smartSpecific" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary">
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 font-semibold text-gray-800">Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù‚ÙŠØ§Ø³ (Measurable)</td>
                    <td class="px-6 py-4 text-gray-600">Ø­Ø¯Ø¯ ÙƒÙŠÙÙŠØ© Ù‚ÙŠØ§Ø³ Ø§Ù„ØªÙ‚Ø¯Ù… Ø£Ùˆ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø£Ùˆ Ø§Ù„Ù†Ø³Ø¨.</td>
                    <td class="px-6 py-4 text-center">
                      <input id="smartMeasurable" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary">
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 font-semibold text-gray-800">Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ­Ù‚Ù‚ (Achievable)</td>
                    <td class="px-6 py-4 text-gray-600">Ù‡Ù„ ÙŠÙ…ÙƒÙ† ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù ÙØ¹Ù„Ø§Ù‹ Ø¨Ø§Ù„Ø¥Ù…ÙƒØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŸ</td>
                    <td class="px-6 py-4 text-center">
                      <input id="smartAchievable" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary">
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 font-semibold text-gray-800">ÙˆØ§Ù‚Ø¹ÙŠ (Realistic)</td>
                    <td class="px-6 py-4 text-gray-600">Ù‡Ù„ Ø§Ù„Ù‡Ø¯Ù Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¥Ù…ÙƒØ§Ù†Ø§ØªØŸ</td>
                    <td class="px-6 py-4 text-center">
                      <input id="smartRealistic" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary">
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 font-semibold text-gray-800">Ø¨Ø²Ù…Ù† Ù…Ø­Ø¯Ø¯ (Time-bound)</td>
                    <td class="px-6 py-4 text-gray-600">Ø­Ø¯Ø¯ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù.</td>
                    <td class="px-6 py-4 text-center">
                      <input id="smartTimeBound" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary">
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© -->
        <div class="border-b border-gray-200 pb-6">
          <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
            <svg class="w-6 h-6 ml-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
            </svg>
            Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©
          </h2>

          <div class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ <span class="text-red-500">*</span>
                </label>
                <select id="department" required
                        class="custom-select w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© <span class="text-red-500">*</span>
                </label>
                <select id="priority" required
                        class="custom-select w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</option>
                  <option value="LOW">Ù…Ù†Ø®ÙØ¶Ø©</option>
                  <option value="MEDIUM">Ù…ØªÙˆØ³Ø·Ø©</option>
                  <option value="HIGH">Ø¹Ø§Ù„ÙŠØ©</option>
                  <option value="CRITICAL">Ø­Ø±Ø¬Ø©</option>
                </select>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
                </label>
                <input type="date" id="startDate"
                       class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
                </label>
                <input type="date" id="dueDate"
                       class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              </div>
            </div>
          </div>
        </div>

        <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
        <div class="flex gap-3 pt-4">
          <button type="submit"
                  class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 font-semibold transition-colors">
            Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
          </button>
          <button type="button" id="draftBtn"
                  class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 font-semibold transition-colors">
            Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©
          </button>
          <a href="./select-type.html"
             class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 font-semibold transition-colors text-center">
            Ø¥Ù„ØºØ§Ø¡
          </a>
        </div>

      </form>

    </div>
  </div>

  <!-- Toast Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ -->
  <div id="toast" class="fixed bottom-6 right-6 z-[9999] hidden">
    <div id="toastInner" class="rounded-xl shadow-lg px-4 py-3 text-sm"></div>
  </div>

  <script>
    const API_BASE_RAW = (localStorage.getItem('apiBase') || 'http://localhost:3001').replace(/\/$/, '');
    const API_BASE = API_BASE_RAW.endsWith('/api') ? API_BASE_RAW : `${API_BASE_RAW}/api`;
    const token = localStorage.getItem('token') || '';

    // Helper functions
    const toast = (msg, type='info') => {
      const el = document.getElementById('toast');
      const box = document.getElementById('toastInner');
      const cls = {
        success:'bg-green-600 text-white',
        error:'bg-red-600 text-white',
        info:'bg-gray-800 text-white',
        warn:'bg-amber-500 text-white'
      }[type] || 'bg-gray-800 text-white';
      box.className = 'rounded-xl shadow-lg px-4 py-3 text-sm ' + cls;
      box.textContent = msg;
      el.classList.remove('hidden');
      setTimeout(() => el.classList.add('hidden'), 3000);
    };

    function effectiveHospitalId() {
      const u = JSON.parse(localStorage.getItem('userData') || '{}');
      const q = new URLSearchParams(location.search);
      const fromUrl = Number(q.get('hospitalId') || q.get('hid') || 0);
      const fromLS1 = Number(localStorage.getItem('selectedHospitalId') || 0);
      const fromLS2 = Number(localStorage.getItem('hospitalId') || 0);
      const fromUser = Number(u.HospitalID || u.hospitalId || u.hid || 0);
      return fromUrl || fromLS1 || fromLS2 || fromUser || null;
    }

    const authHeaders = () => {
      const h = token ? { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' } : { 'Content-Type': 'application/json' };
      const hid = effectiveHospitalId();
      if (hid) h['x-hospital-id'] = String(hid);
      return h;
    };

    async function loadDepartments() {
      try {
        const token = localStorage.getItem('token') || '';
        const deptSelect = document.getElementById('department');
        const hospitalSelect = document.getElementById('hospitalSelect');
        const currentUser = JSON.parse(localStorage.getItem('userData') || '{}');

        let hospitalId = null;

        if (hospitalSelect && hospitalSelect.value) {
          hospitalId = hospitalSelect.value;
        } else if (currentUser && currentUser.HospitalID) {
          hospitalId = currentUser.HospitalID;
        } else if (effectiveHospitalId()) {
          hospitalId = effectiveHospitalId();
        }

        if (!hospitalId) {
          if (deptSelect) deptSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…Ø³ØªØ´ÙÙ‰ Ø£ÙˆÙ„Ø§Ù‹</option>';
          return;
        }

        const headers = { Accept: 'application/json' };
        if (token) headers['Authorization'] = `Bearer ${token}`;
        headers['x-hospital-id'] = String(hospitalId);

        const res = await fetch(`${API_BASE}/departments?hospitalId=${hospitalId}`, { headers });

        if (!res.ok) {
          console.warn('âš ï¸ [loadDepartments] departments endpoint failed with status', res.status);
          const fallbackRes = await fetch(`${API_BASE}/lookups/departments?hospitalId=${hospitalId}`, { headers });
          if (!fallbackRes.ok) {
            const errText = await fallbackRes.text().catch(() => '');
            throw new Error(`HTTP ${fallbackRes.status} ${errText}`);
          }
          const fallbackJson = await fallbackRes.json();
          populateDepartments(deptSelect, fallbackJson);
          return;
        }

        const result = await res.json();
        populateDepartments(deptSelect, result);

      } catch (err) {
        console.error('âŒ Error loading departments:', err);
        toast('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…', 'error');
      }
    }

    function populateDepartments(selectEl, response) {
      if (!selectEl) return;

      let data = [];

      if (response && response.success && Array.isArray(response.data)) {
        data = response.data;
      } else if (response && response.ok && Array.isArray(response.data)) {
        data = response.data;
      } else if (Array.isArray(response)) {
        data = response;
      } else if (response && Array.isArray(response.items)) {
        data = response.items;
      } else {
        console.warn('âš ï¸ [populateDepartments] Unexpected response format:', response);
      }

      selectEl.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>';

      data.forEach(d => {
        const o = document.createElement('option');
        const deptId = d.DepartmentID || d.id || d.DepartmentId || d.ID;
        const deptName = d.NameAr || d.DepartmentName || d.nameAr || d.Name || d.name;
        if (deptId && deptName) {
          o.value = deptId;
          o.textContent = deptName;
          selectEl.appendChild(o);
        }
      });
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„ÙØ±Ø¹ÙŠØ©
    async function loadCategories() {
      try {
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹
        const hospitalSelect = document.getElementById('hospitalSelect');
        const selectedHospitalId = hospitalSelect && hospitalSelect.value;
        const hid = selectedHospitalId || effectiveHospitalId();
        
        const headers = authHeaders();
        if (hid) headers['x-hospital-id'] = String(hid);

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø®ØªØ§Ø±
        const mainQuery = new URLSearchParams();
        if (hid) mainQuery.set('hospitalId', hid);
        const mainRes = await fetch(`${API_BASE}/complaint-types${mainQuery.toString() ? '?' + mainQuery.toString() : ''}`, { headers });
        const mainData = await mainRes.json();
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¯ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† - Ø¯Ø¹Ù… Ø£Ø´ÙƒØ§Ù„ Ù…Ø®ØªÙ„ÙØ© Ù…Ù† Ø§Ù„Ø±Ø¯ÙˆØ¯
        const mainList = Array.isArray(mainData.data)
          ? mainData.data
          : Array.isArray(mainData)
            ? mainData
            : Array.isArray(mainData.data?.types)
              ? mainData.data.types
              : [];
        
        const mainSelect = document.getElementById('mainType');
        mainSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</option>';
        mainList.forEach(t => {
          const opt = document.createElement('option');
          const typeId = t.ComplaintTypeID || t.TypeID || t.id || t.ID;
          const typeName = t.TypeName || t.NameAr || t.nameAr || t.TypeNameAr || t.TypeNameEn;
          opt.value = typeId || '';
          opt.textContent = typeName || 'ØªØµÙ†ÙŠÙ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
          mainSelect.appendChild(opt);
        });

        // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØŒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©
        mainSelect.onchange = async () => {
          const subSelect = document.getElementById('subType');
          subSelect.innerHTML = '<option value="">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>';
          
          if (!mainSelect.value) {
            subSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„ÙØ±Ø¹ÙŠ</option>';
            return;
          }
          
          const subHeaders = { ...authHeaders() };
          const selectedHospital = document.getElementById('hospitalSelect')?.value || hid;
          if (selectedHospital) subHeaders['x-hospital-id'] = String(selectedHospital);

          const query = new URLSearchParams({ typeId: mainSelect.value });
          if (selectedHospital) query.set('hospitalId', selectedHospital);

          const subRes = await fetch(`${API_BASE}/complaint-subtypes?${query.toString()}`, { headers: subHeaders });
          const subData = await subRes.json();
          
          // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¯ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
          const subs = Array.isArray(subData.data)
            ? subData.data
            : Array.isArray(subData)
              ? subData
              : Array.isArray(subData.data?.subtypes)
                ? subData.data.subtypes
                : [];
          
          subSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„ÙØ±Ø¹ÙŠ</option>';
          subs.forEach(s => {
            const o = document.createElement('option');
            const subId = s.SubTypeID || s.SubtypeID || s.id || s.ID;
            const subName = s.SubTypeName || s.NameAr || s.nameAr || s.SubTypeNameAr || s.SubTypeNameEn;
            o.value = subId || '';
            o.textContent = subName || 'ØªØµÙ†ÙŠÙ ÙØ±Ø¹ÙŠ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            subSelect.appendChild(o);
          });
        };
      } catch (e) {
        console.error('Error loading categories:', e);
        toast('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª', 'error');
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª
    async function loadHospitals() {
      try {
        const res = await fetch(`${API_BASE}/lookups/hospitals`, { headers: authHeaders() });
        if (!res.ok) throw new Error('HTTP ' + res.status);

        const response = await res.json();
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¯ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
        const list = Array.isArray(response.data)
          ? response.data
          : Array.isArray(response)
            ? response
            : [];
        
        const select = document.getElementById('hospitalSelect');
        select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</option>';
        
        list.forEach(h => {
          const opt = document.createElement('option');
          opt.value = h.HospitalID;
          opt.textContent = h.HospitalNameAr || h.NameAr;
          select.appendChild(opt);
        });

        // âœ… Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù…
        select.addEventListener('change', async () => {
          const hospitalId = select.value;
          console.log('ğŸ¥ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰:', hospitalId);
          
          if (hospitalId) {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø®ØªØ§Ø±
            await loadCategories();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø®ØªØ§Ø±
            await loadDepartments();
          } else {
            // Ù…Ø³Ø­ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù…
            const mainSelect = document.getElementById('mainType');
            const subSelect = document.getElementById('subType');
            const deptSelect = document.getElementById('department');
            
            if (mainSelect) mainSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</option>';
            if (subSelect) subSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„ÙØ±Ø¹ÙŠ</option>';
            if (deptSelect) deptSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>';
          }
        });
      } catch (e) {
        console.error('Error loading hospitals:', e);
        toast('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª', 'error');
      }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('projectForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      await submitProject('PROPOSED');
    });

    document.getElementById('draftBtn').addEventListener('click', async () => {
      await submitProject('DRAFT');
    });

    async function submitProject(status) {
      try {
        const hid = effectiveHospitalId();
        const selectedHospitalId = document.getElementById('hospitalSelect').value;
        
        if (!selectedHospitalId && !hid) {
          toast('ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰', 'warn');
          return;
        }

        const projectCategorySelect = document.getElementById('projectCategory');
        const projectCategoryOtherInput = document.getElementById('projectCategoryOther');
        const projectCategoryValue = projectCategorySelect.value;
        const otherCategoryValue = (projectCategoryOtherInput?.value || '').trim();
        const isOtherCategory = projectCategoryValue === 'Ø£Ø®Ø±Ù‰';

        if (isOtherCategory && !otherCategoryValue) {
          toast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± "Ù…Ø´Ø±ÙˆØ¹ Ø£Ø®Ø±Ù‰"', 'warn');
          projectCategoryOtherInput?.focus();
          return;
        }

        const smartSpecific = document.getElementById('smartSpecific')?.checked || false;
        const smartMeasurable = document.getElementById('smartMeasurable')?.checked || false;
        const smartAchievable = document.getElementById('smartAchievable')?.checked || false;
        const smartRealistic = document.getElementById('smartRealistic')?.checked || false;
        const smartTimeBound = document.getElementById('smartTimeBound')?.checked || false;

        const data = {
          hospitalId: selectedHospitalId || hid,
          projectType: '937',
          projectCategory: isOtherCategory ? otherCategoryValue : projectCategoryValue,
          projectCategoryOriginal: projectCategoryValue,
          projectCategoryOther: isOtherCategory ? otherCategoryValue : null,
          title: document.getElementById('projectName').value,
          mainTypeId: document.getElementById('mainType').value,
          subTypeId: document.getElementById('subType').value,
          impactReason: document.getElementById('impactReason').value,
          projectName: document.getElementById('projectName').value,
          projectDescription: document.getElementById('projectDescription').value,
          aimStatement: document.getElementById('aimStatement').value,
          departmentId: document.getElementById('department').value,
          priority: document.getElementById('priority').value || 'MEDIUM',
          status: status,
          startDate: document.getElementById('startDate').value || null,
          dueDate: document.getElementById('dueDate').value || null,
          smartChecklist: {
            specific: smartSpecific,
            measurable: smartMeasurable,
            achievable: smartAchievable,
            realistic: smartRealistic,
            timeBound: smartTimeBound
          }
        };

        const res = await fetch(`${API_BASE}/improvements`, {
          method: 'POST',
          headers: authHeaders(),
          body: JSON.stringify(data)
        });

        const result = await res.json();

        if (res.ok && result.success) {
          toast(status === 'DRAFT' ? 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          setTimeout(() => window.location.href = './list.html', 1500);
        } else {
          toast(result.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸', 'error');
        }
      } catch(err) {
        console.error('Error:', err);
        toast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸', 'error');
      }
    }

    // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
    loadDepartments();
    loadCategories();
    loadHospitals();

    // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ù‚Ù„ "Ø£Ø®Ø±Ù‰" Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
    (function initProjectCategoryOtherField() {
      const select = document.getElementById('projectCategory');
      const container = document.getElementById('projectCategoryOtherContainer');
      const input = document.getElementById('projectCategoryOther');

      if (!select || !container) return;

      const toggleOtherField = () => {
        if (select.value === 'Ø£Ø®Ø±Ù‰') {
          container.classList.remove('hidden');
          setTimeout(() => input?.focus(), 100);
        } else {
          container.classList.add('hidden');
          if (input) input.value = '';
        }
      };

      select.addEventListener('change', toggleOtherField);
      toggleOtherField();
    })();
  </script>

</body>
</html>

