# ุชูุงูู ุตูุญุฉ ุชูุงุตูู ุงูุจูุงุบ ุงูุญุฑุฌ ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช

## โ ุงูุชุญุฏูุซุงุช ุงูููุฌุฒุฉ

ุชู ุชุญุฏูุซ ุตูุญุฉ `critical-details.html` ูุชุญููู ุชูุงุตูู ุงูุจูุงุบ ุงูุญุฑุฌ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ููุณ API ุงูุฎุงุต ุจู `open-details`.

## ๐ง ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ

### 1. ุญุฐู ุชุญููู ุงูุจูุงูุงุช ุงูููููุฉ

#### ูู `critical-details.html`:
```html
<!-- ุชู ุญุฐู ูุฐุง ุงูุณุทุฑ -->
<!-- <script src="data.js"></script> -->
<script src="critical-details.js"></script>
```

### 2. ุงุณุชุจุฏุงู `critical-details.js` ุจุงููุงูู

#### ุงูููุฏ ุงูุฌุฏูุฏ:
```javascript
// critical-details.js โ ูุฌูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

const API_BASE = (location.port === '3001') ? '' : 'http://localhost:3001';

// ุงุณุชุฏุนุงุก ุชูุงุตูู ุงูุจูุงุบ ูู ุงูุจุงู-ุฅูุฏ (ููุณ ูุณุงุฑ open-details)
async function getComplaintById(id){
  const res = await fetch(`${API_BASE}/api/complaints/${encodeURIComponent(id)}`);
  if(!res.ok) throw new Error('HTTP '+res.status);
  return await res.json();
}
```

## ๐ฏ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ุงุณุชุฎุฏุงู ููุณ API
- **ููุณ ุงููุณุงุฑ**: `/api/complaints/:id`
- **ููุณ ุงูุจูุงูุงุช**: ูุซู ุตูุญุฉ `open-details`
- **ุชูุญูุฏ ุงููุตุฏุฑ**: ูุงุนุฏุฉ ุจูุงูุงุช ูุงุญุฏุฉ

### 2. ุงูุชุญูู ูู ููุน ุงูุจูุงุบ
```javascript
// ุชุฃููุฏ ุฃู ุงูุจูุงุบ ุญุฑุฌ ูุนูุงู
if ((rpt.category || '').toLowerCase() !== 'critical') {
  // ุนุฑุถ "ุบูุฑ ุญุฑุฌ" ุฃู ุชุญููู ูุตูุญุฉ open-details
  setChip(priorityChip, 'ุบูุฑ ุญุฑุฌ', 'pill-yellow');
}
```

### 3. ูุนุงูุฌุฉ ุขููุฉ ูููุตูุต
```javascript
function escapeHTML(s){
  return String(s ?? '')
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;').replace(/'/g,'&#039;');
}
```

### 4. ุนุฑุถ ุงูุญุงูุงุช ุจุงูุนุฑุจู
```javascript
// ุงูุญุงูุฉ
const st = (r.status || '').trim().toLowerCase();
if (st.includes('closed') || st.includes('ูุบู')) setChip(statusEl, 'ูุบูู', 'pill-green');
else if (st.includes('in_progress') || st.includes('ููุฏ')) setChip(statusEl, 'ููุฏ ุงููุนุงูุฌุฉ', 'pill-blue');
else setChip(statusEl, 'ููุชูุญ', 'pill-orange');
```

## ๐ ูููู ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ

### API Response (ููุณ open-details):
```json
{
  "id": "C-8",
  "complaintId": 8,
  "hospital": "ูุณุชุดูู ุงูููู ุนุจุฏุงูุนุฒูุฒ",
  "dept": "ุงูุทูุงุฑุฆ",
  "category": "critical",
  "status": "OPEN",
  "createdAt": "2025-01-16T10:30:00.000Z",
  "updatedAt": "2025-01-16T10:30:00.000Z",
  "reporter": "ุฃุญูุฏ ูุญูุฏ",
  "assignee": null,
  "source": "ููุธููุฉ 937",
  "description": "ูุตู ุงูุจูุงุบ ุงูุญุฑุฌ...",
  "attachments": [...],
  "history": [...]
}
```

## ๐ ุงููุฑูู ุนู open-details

### 1. ุงูุชุญูู ูู ุงูููุน
- **critical-details**: ูุชุญูู ูู ุฃู ุงูุจูุงุบ ุญุฑุฌ
- **open-details**: ูุนุฑุถ ุฃู ููุน ูู ุงูุจูุงุบุงุช

### 2. ุนุฑุถ ุงูุฃููููุฉ
- **ุญุฑุฌ**: ุฅุฐุง ูุงู `category === 'critical'`
- **ุบูุฑ ุญุฑุฌ**: ุฅุฐุง ูู ููู ุญุฑุฌ (ูุน ุฅููุงููุฉ ุงูุชุญููู)

### 3. ุงูุชุตููู
- **ููุณ ุงูุชุตููู**: ููู ูุน ุชุฑููุฒ ุนูู ุงูุจูุงุบุงุช ุงูุญุฑุฌุฉ
- **ุฃููุงู ูููุฒุฉ**: ููุจูุงุบุงุช ุงูุญุฑุฌุฉ

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ูุชุญ ุตูุญุฉ ุงูุจูุงุบ ุงูุญุฑุฌ:
```
critical-details.html?id=8
```

### 2. ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- **ุฅุฐุง ูุงู ุญุฑุฌ**: ุนุฑุถ ุชูุงุตูู ุงูุจูุงุบ ุงูุญุฑุฌ
- **ุฅุฐุง ูู ููู ุญุฑุฌ**: ุนุฑุถ "ุบูุฑ ุญุฑุฌ" ุฃู ุชุญููู ุชููุงุฆู

### 3. ุงุฎุชุจุงุฑ API:
```bash
curl "http://localhost:3001/api/complaints/8"
```

## ๐ ุฅููุงููุฉ ุงูุชุญููู ุงูุชููุงุฆู

### ุชูุนูู ุงูุชุญููู ููุจูุงุบุงุช ุบูุฑ ุงูุญุฑุฌุฉ:
```javascript
// ูู ุฏุงูุฉ boot()
if ((rpt.category || '').toLowerCase() !== 'critical') {
  // ุชุญููู ุชููุงุฆู ูุตูุญุฉ open-details
  location.href = `open-details.html?id=${encodeURIComponent(id)}`;
}
```

## ๐จ ุนุฑุถ ุงูุจูุงูุงุช

### 1. ุงูุฑุฃุณ:
- **ุงูุนููุงู**: ุชูุงุตูู ุงูุจูุงุบ (C-8)
- **ุงููุณุชุดูู**: ุงุณู ุงููุณุชุดูู
- **ุงูุฃููููุฉ**: ุญุฑุฌ/ุบูุฑ ุญุฑุฌ
- **ุงูุญุงูุฉ**: ููุชูุญ/ููุฏ ุงููุนุงูุฌุฉ/ูุบูู

### 2. ุงูุชูุงุตูู:
- **ุงููุณุชุดูู ูุงููุณู**
- **ุงูุชูุงุฑูุฎ**: ุงูุฅูุดุงุก ูุงูุชุญุฏูุซ
- **ุงููุณุคูููู**: ุตุงุญุจ ุงูุจูุงุบ ูุงููููู
- **ุงููุตุฏุฑ ูุงููุตู**

### 3. ุงููุฑููุงุช:
- **ุนุฑุถ ุขูู**: ูุน escape ูููุตูุต
- **ุฑูุงุจุท ุตุญูุญุฉ**: ูููููุงุช ุงููุฑููุฉ
- **ุฑุณุงูุฉ ูุงุถุญุฉ**: ุนูุฏ ุนุฏู ูุฌูุฏ ูุฑููุงุช

### 4. ุงูุณุฌู ุงูุฒููู:
- **ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**: logs ุฃู complaint_responses
- **ุนุฑุถ ุฒููู**: ูุน ุงูุชูุงุฑูุฎ ูุงูุฃููุงุช
- **ุงููุณุคูููู**: ูู ูุงู ุจุงูุนูู

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ:

1. **404 - Complaint not found**:
   - ุชุฃูุฏ ูู ูุฌูุฏ ุงูุจูุงุบ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุชุญูู ูู ุตุญุฉ ID ุงููุฑุณู

2. **ุงูุจูุงุบ ุบูุฑ ุญุฑุฌ**:
   - ุงูุตูุญุฉ ุชุนุฑุถ "ุบูุฑ ุญุฑุฌ"
   - ูููู ุชูุนูู ุงูุชุญููู ุงูุชููุงุฆู

3. **ูุง ุชุธูุฑ ุงูุจูุงูุงุช**:
   - ุชุญูู ูู ุฃู ุงูุฎุงุฏู ูุนูู
   - ุฑุงุฌุน console ุงููุชุตูุญ

### ุฑุณุงุฆู Console:
- `critical-details boot error: HTTP 404`
- `critical-details boot error: HTTP 500`
- `ุชุนุฐุฑ ุฌูุจ ุจูุงูุงุช ุงูุจูุงุบ.`

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฃูุงู**: ุงุณุชุฎุฏุงู escapeHTML ููุญูุงูุฉ ูู XSS
2. **ุงูุฃุฏุงุก**: ููุณ API ุงููุณุชุฎุฏู ูู open-details
3. **ุงููุฑููุฉ**: ุฏุนู ุงูุจูุงุบุงุช ุงูุญุฑุฌุฉ ูุบูุฑ ุงูุญุฑุฌุฉ
4. **ุงูุชูุงูู**: ูุนูู ูุน ุงูุจููุฉ ุงูุญุงููุฉ ููุตูุญุฉ

ุงูุขู ุตูุญุฉ ุชูุงุตูู ุงูุจูุงุบ ุงูุญุฑุฌ ุชุนูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญููููุฉ! ๐๐ดโจ
