<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../assets/css/styles.css" />
</head>

<body class="bg-gray-50" style="font-family: 'Tajawal', sans-serif">

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header id="navbar" class="fixed w-full top-0 z-50 navbar-scroll" style="background-color: #002B5B;">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center">
          <img src="../assets/img/logo3.png" alt="Ø´Ø¹Ø§Ø± ØªØ¬Ù…Ø¹ Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø§Ù„ØµØ­ÙŠ" class="h-16 w-auto" />
        </div>
        <nav class="hidden md:flex items-center space-x-reverse space-x-8">
          <a href="../../index/landing.html" id="nav-home" class="text-white hover:text-blue-200 transition-colors">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
          <a href="../../index/landing.html#features" id="nav-features" class="text-white hover:text-blue-200 transition-colors">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
          <a href="../../index/landing.html#contact" id="nav-contact" class="text-white hover:text-blue-200 transition-colors">ØªÙˆØ§ØµÙ„</a>
          <button id="languageToggle" class="text-white hover:text-blue-200 transition-colors flex items-center">
            ğŸŒ English
          </button>
        </nav>
      </div>
    </div>
  </header>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
  <main class="flex items-center justify-center min-h-screen px-4 pt-24 pb-10">
    <div class="w-full max-w-md bg-white rounded-2xl shadow-lg border border-gray-100 p-8">

      <div class="text-center mb-8">
        <h1 id="page-title" class="text-2xl font-extrabold text-[#002B5B] mb-2">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
        <p id="page-subtitle" class="text-gray-600">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</p>
      </div>

      <form id="loginForm" class="space-y-5" novalidate>
        <!-- ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø¯ÙˆØ± - Ø³ÙŠØªÙ… Ø§ÙƒØªØ´Ø§ÙÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->

        <!-- ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ - Ø³ÙŠØªÙ… Ø§ÙƒØªØ´Ø§ÙÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->

        <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ -->
        <div>
          <label id="username-label" class="block mb-1 font-semibold text-gray-700">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="text" id="username" required placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯"
                 class="w-full rounded-xl border-gray-300 focus:ring-[#002B5B] focus:border-[#002B5B]" 
                 data-placeholder-ar="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯" data-placeholder-en="Enter username or email" />
        </div>

        <!-- ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
        <div>
          <label id="password-label" class="block mb-1 font-semibold text-gray-700">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input type="password" id="password" required placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                 class="w-full rounded-xl border-gray-300 focus:ring-[#002B5B] focus:border-[#002B5B]" 
                 data-placeholder-ar="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" data-placeholder-en="Password" />
        </div>

        <!-- ØªØ°ÙƒÙ‘Ø±Ù†ÙŠ -->
        <div class="flex items-center justify-between">
          <label class="flex items-center gap-2 text-gray-700 text-sm">
            <input id="remember" type="checkbox" class="rounded border-gray-300 text-[#002B5B] focus:ring-[#002B5B]" />
            <span id="remember-me">ØªØ°ÙƒÙ‘Ø±Ù†ÙŠ</span>
          </label>
          <a href="#" id="forgot-password" class="text-sm text-[#002B5B] hover:underline">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
        </div>

        <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <button type="submit" id="login-btn"
                class="w-full py-3 rounded-xl bg-[#002B5B] hover:bg-[#013b7a] text-white font-semibold shadow-md transition">
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        </button>

        <p class="text-center text-sm text-gray-600 mt-3">
          <span id="signup-question">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</span>
          <a href="signup.html" id="signup-link" class="text-[#002B5B] font-semibold hover:underline">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
        </p>
      </form>
    </div>
  </main>

  <!-- Footer - Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
  <footer class="bg-gray-900 text-white py-14">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-3 gap-8">
        <!-- Column 1 - Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„ -->
        <div>
          <div class="flex items-center space-x-reverse space-x-3 mb-4">
            <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
              </svg>
            </div>
            <div>
              <div id="footer-org-name" class="font-bold">ØªØ¬Ù…Ø¹ Ù…ÙƒØ© Ø§Ù„ØµØ­ÙŠ</div>
              <div id="footer-system-name" class="text-sm text-gray-300">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</div>
            </div>
          </div>
          <p id="footer-description" class="text-gray-300 text-sm">Ù…Ù†ØµØ© Ø±Ø³Ù…ÙŠØ© Ù„ØªÙ‚Ø¯ÙŠÙ… ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</p>
        </div>

        <!-- Column 2 - Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø«Ø§Ù†ÙŠ -->
        <div>
          <h3 id="footer-links-title" class="font-bold mb-4">Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h3>
          <ul class="space-y-2 text-sm">
            <li><a href="../../index/index.html" id="footer-link-home" class="text-gray-300 hover:text-white hover:underline transition-colors">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="../complaints/submit/submit-complaint.html" id="footer-link-submit" class="text-gray-300 hover:text-white hover:underline transition-colors">ØªÙ‚Ø¯ÙŠÙ… Ø¨Ù„Ø§Øº</a></li>
            <li><a href="../complaints/track/track-complaint.html" id="footer-link-track" class="text-gray-300 hover:text-white hover:underline transition-colors">Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ù„Ø§Øº</a></li>
            <li><a href="../../index/help.html" id="footer-link-faq" class="text-gray-300 hover:text-white hover:underline transition-colors">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</a></li>
          </ul>
        </div>

        <!-- Column 3 - Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø«Ø§Ù„Ø« -->
        <div>
          <h3 id="footer-contact-title" class="font-bold mb-4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</h3>
          <div class="space-y-2 text-sm text-gray-300">
            <div class="flex items-baseline">
              <svg class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
              <span id="footer-support-number">Ø±Ù‚Ù… Ø§Ù„Ø¯Ø¹Ù…: 0559735137</span>
            </div>
            <div class="flex items-baseline">
              <svg class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
              <span id="footer-support-number-2">Ø±Ù‚Ù… Ø§Ù„Ø¯Ø¹Ù…: 0542282550</span>
            </div>
            <div class="flex items-baseline">
              <svg class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              <span id="footer-support-email">support@makkahhealth.gov.sa</span>
            </div>
            <div class="flex items-baseline">
              <svg class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span id="footer-working-hours">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: 24/7</span>
            </div>
          </div>
        </div>
      </div>

      <div class="border-t border-gray-700 mt-8 pt-8 text-center text-sm text-gray-300">
        <span id="footer-copyright">Â© 2025 ØªØ¬Ù…Ø¹ Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø§Ù„ØµØ­ÙŠ â€“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</span>
      </div>
    </div>
  </footer>

  <!-- Ù…ÙƒØ§Ù† Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ³Øª -->
  <div id="toast-root" class="fixed top-4 right-4 z-[9999] space-y-3 pointer-events-none"></div>

  <!-- Ø¯Ø§Ù„Ø© Toast -->
  <script>
    function showToast({ title = '', message = '', type = 'success', duration = 3000 } = {}) {
      const root = document.getElementById('toast-root');
      if (!root) return;

      const colors = {
        success: { bg: 'bg-green-600', ring: 'ring-green-500/30', icon: 'âœ…' },
        error:   { bg: 'bg-red-600',   ring: 'ring-red-500/30',   icon: 'âŒ' },
        warning: { bg: 'bg-yellow-600',ring: 'ring-yellow-500/30',icon: 'âš ï¸' },
        info:    { bg: 'bg-blue-600',  ring: 'ring-blue-500/30',  icon: 'â„¹ï¸' }
      }[type] || { bg: 'bg-slate-700', ring: 'ring-slate-500/30', icon: 'â„¹ï¸' };

      const el = document.createElement('div');
      el.className =
        `pointer-events-auto ${colors.bg} text-white shadow-xl ring-1 ${colors.ring} rounded-xl px-4 py-3 w-[320px]
         translate-y-2 opacity-0 transition-all duration-300 flex items-start gap-3`;
      el.setAttribute('role', 'status');
      el.innerHTML = `
        <div class="text-xl leading-none mt-0.5">${colors.icon}</div>
        <div class="flex-1">
          <div class="font-semibold">${title}</div>
          ${message ? `<div class="text-white/90 text-sm mt-0.5">${message}</div>` : ''}
        </div>
        <button class="ml-2 text-white/80 hover:text-white transition" aria-label="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
      `;

      const close = () => {
        el.classList.add('opacity-0', 'translate-y-2');
        setTimeout(() => el.remove(), 250);
      };
      el.querySelector('button').onclick = close;

      root.appendChild(el);
      // Ø§Ø¯Ø®Ø§Ù„ Ø£Ù†ÙŠÙ…ÙŠØ´Ù€Ù†
      requestAnimationFrame(() => el.classList.remove('opacity-0', 'translate-y-2'));
      // Ø¥Ø²Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
      setTimeout(close, duration);
    }
  </script>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø¨Ø§Ùƒ-Ø¥Ù†Ø¯ -->
  <script>
    const API_BASE = 'http://localhost:3001/api';

    document.getElementById('loginForm').addEventListener('submit', handleLogin);

    async function handleLogin(e){
      e.preventDefault();

      // Ø§Ù‚Ø±Ø£ Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ø§Ù„Ù€ IDs Ø§Ù„ØµØ­ÙŠØ­Ø©
      const username = (document.getElementById('username')?.value || '').trim();
      const password = (document.getElementById('password')?.value || '');

      if (!username || !password) {
        alert('Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
        return;
      }

      const btn = document.getElementById('login-btn');
      const old = btn.textContent;
      btn.disabled = true; btn.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‘Ù‚...';

      try {
        // Ø£Ø±Ø³Ù„ JSON ØµØ±ÙŠØ­ Ù…Ø¹ Content-Type Ø§Ù„ØµØ­ÙŠØ­
        const res = await fetch(`${API_BASE}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        const data = await res.json();

        if (!res.ok) {
          // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ© Ù„Ø±Ø³Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±
          if (res.status === 403 && data.message && data.message.includes('Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±')) {
            showToast({
              title: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±ÙÙˆØ¶',
              message: data.message,
              type: 'warning',
              duration: 5000
            });
          } else {
            alert(data.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
          }
          return;
        }

        // Ù†Ø¬Ø§Ø­ - Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØµØ­ÙŠØ­Ø© (ÙƒÙ„Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ÙŠÙ† Ù„Ù„ØªÙˆØ§ÙÙ‚)
        localStorage.setItem('authToken', data.token);
        localStorage.setItem('token', data.token); // Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ authHeaders()
        localStorage.setItem('userData', JSON.stringify(data.user));
        localStorage.setItem('user', JSON.stringify(data.user)); // Ù„Ù„ØªÙˆØ§ÙÙ‚
        localStorage.setItem('userRole', data.user.RoleCode || data.user.RoleID || 'user');
        
        // Ø­ÙØ¸ hospitalId Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹
        if (data.user && data.user.HospitalID) {
          localStorage.setItem('hospitalId', data.user.HospitalID);
        } else if (data.user && data.user.hospitalId) {
          localStorage.setItem('hospitalId', data.user.hospitalId);
        }
        
        // Ø¬Ù„Ø¨ ÙˆØ­ÙØ¸ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        try {
          const API_BASE = window.API_BASE || 'http://localhost:3001';
          const permsUrl = `${API_BASE}/api/permissions/me`;
          const params = new URLSearchParams();
          if (data.user?.HospitalID) {
            params.set('hospitalId', data.user.HospitalID);
          }
          
          const permsRes = await fetch(`${permsUrl}${params.toString() ? '?' + params.toString() : ''}`, {
            headers: {
              'Authorization': `Bearer ${data.token}`,
              'Accept': 'application/json'
            },
            credentials: 'include'
          });
          
          if (permsRes.ok) {
            const permsData = await permsRes.json();
            if (permsData.ok && permsData.data) {
              localStorage.setItem('permissions', JSON.stringify(permsData.data));
              console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
            }
          } else {
            console.warn('âš ï¸ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:', permsRes.status);
          }
        } catch (permsError) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:', permsError);
        }
        
        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
        console.log('ğŸ“¦ Token:', data.token ? 'Ù…ÙˆØ¬ÙˆØ¯ âœ…' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ âŒ');
        console.log('ğŸ“¦ HospitalID:', data.user?.HospitalID || data.user?.hospitalId || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯');
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
        showToast({
          title: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­',
          message: `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${data.user.FullName || data.user.Username}`,
          type: 'success',
          duration: 2000
        });
        
        // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        let redirectUrl = '/';
        if (data.user && data.user.RoleCode === 'CLUSTER_ADMIN') {
          redirectUrl = '/NewProjectMecca/public/admin/admin-hub.html';
        } else if (data.user && data.user.RoleCode === 'HOSPITAL_ADMIN') {
          redirectUrl = '/NewProjectMecca/public/admin/admin-hub.html';
        } else if (data.user && data.user.RoleCode === 'EMPLOYEE') {
          redirectUrl = '/NewProjectMecca/public/complaints/history/complaints-history.html';
        }
        
        // ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø«Ù… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
        setTimeout(() => {
          window.location.href = data.redirect || redirectUrl;
        }, 1500);
      } catch (err) {
        alert('ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
        console.error(err);
      } finally {
        btn.disabled = false; btn.textContent = old;
      }
    }

    // ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… - Ù„Ù… ÙŠØ¹Ø¯ Ù…Ø·Ù„ÙˆØ¨Ø§Ù‹

    // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ API
    async function testAPIConnection() {
      try {
        const response = await fetch(`${API_BASE}/health`);
        const result = await response.json();
        console.log('âœ… API Ù…ØªØ§Ø­:', result.message);
        return true;
      } catch (error) {
        console.error('âŒ API ØºÙŠØ± Ù…ØªØ§Ø­:', error);
        return false;
      }
    }

    // ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ±
    window.addEventListener("scroll", () => {
      const navbar = document.getElementById("navbar");
      const links = navbar.querySelectorAll("a");
      if (window.scrollY > 50) {
        navbar.style.backgroundColor = "#ffffff";
        navbar.classList.add("shadow-md");
        links.forEach(a => {
          a.classList.remove("text-white", "hover:text-blue-200");
          a.classList.add("text-[#002B5B]", "hover:text-blue-700");
        });
      } else {
        navbar.style.backgroundColor = "#002B5B";
        navbar.classList.remove("shadow-md");
        links.forEach(a => {
          a.classList.add("text-white", "hover:text-blue-200");
          a.classList.remove("text-[#002B5B]", "hover:text-blue-700");
        });
      }
    });
  </script>

  <!-- Translation System - Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø© -->
  <script>
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø©
    const translations = {
      ar: {
        // Ø§Ù„Ù‡ÙŠØ¯Ø±
        'nav-home': 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
        'nav-features': 'Ø§Ù„Ø®Ø¯Ù…Ø§Øª',
        'nav-contact': 'ØªÙˆØ§ØµÙ„',
        'language-button': 'ğŸŒ English',
        
        // Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        'page-title': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
        'page-subtitle': 'Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª',
        
        // Ø§Ù„Ø­Ù‚ÙˆÙ„
        'username-label': 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
        'password-label': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
        'remember-me': 'ØªØ°ÙƒÙ‘Ø±Ù†ÙŠ',
        'forgot-password': 'Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ',
        
        // Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ù†ØµÙˆØµ
        'login-btn': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
        'signup-question': 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ',
        'signup-link': 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯',
        
        // Ø§Ù„ÙÙˆØªÙŠØ±
        'footer-org-name': 'ØªØ¬Ù…Ø¹ Ù…ÙƒØ© Ø§Ù„ØµØ­ÙŠ',
        'footer-system-name': 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª',
        'footer-description': 'Ù…Ù†ØµØ© Ø±Ø³Ù…ÙŠØ© Ù„ØªÙ‚Ø¯ÙŠÙ… ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª',
        'footer-links-title': 'Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©',
        'footer-link-home': 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
        'footer-link-submit': 'ØªÙ‚Ø¯ÙŠÙ… Ø¨Ù„Ø§Øº',
        'footer-link-track': 'Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ù„Ø§Øº',
        'footer-link-faq': 'Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©',
        'footer-contact-title': 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„',
        'footer-support-number': 'Ø±Ù‚Ù… Ø§Ù„Ø¯Ø¹Ù…: 0559735137',
        'footer-support-number-2': 'Ø±Ù‚Ù… Ø§Ù„Ø¯Ø¹Ù…: 0542282550',
        'footer-support-email': 'support@makkahhealth.gov.sa',
        'footer-working-hours': 'Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: 24/7',
        'footer-copyright': 'Â© 2025 ØªØ¬Ù…Ø¹ Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø§Ù„ØµØ­ÙŠ â€“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©'
      },
      en: {
        // Ø§Ù„Ù‡ÙŠØ¯Ø±
        'nav-home': 'Home',
        'nav-features': 'Services',
        'nav-contact': 'Contact',
        'language-button': 'ğŸŒ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
        
        // Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        'page-title': 'Sign In',
        'page-subtitle': 'Enter your credentials to access the complaint system',
        
        // Ø§Ù„Ø­Ù‚ÙˆÙ„
        'username-label': 'Username or Email Address',
        'password-label': 'Password',
        'remember-me': 'Remember me',
        'forgot-password': 'Forgot password?',
        
        // Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ù†ØµÙˆØµ
        'login-btn': 'Sign In',
        'signup-question': "Don't have an account?",
        'signup-link': 'Create New Account',
        
        // Ø§Ù„ÙÙˆØªÙŠØ±
        'footer-org-name': 'Makkah Health Cluster',
        'footer-system-name': 'Complaint System',
        'footer-description': 'Official platform for filing and tracking complaints',
        'footer-links-title': 'Quick Links',
        'footer-link-home': 'Home',
        'footer-link-submit': 'Submit Complaint',
        'footer-link-track': 'Track Complaint',
        'footer-link-faq': 'FAQ',
        'footer-contact-title': 'Contact Information',
        'footer-support-number': 'Support Number: 0559735137',
        'footer-support-email': 'support@makkahhealth.gov.sa',
        'footer-working-hours': 'Working Hours: 24/7',
        'footer-copyright': 'Â© 2025 Makkah Health Cluster â€“ All Rights Reserved'
      }
    };

    // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„ØºØ©
    let currentLanguage = 'ar';

    // Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±Ø¬Ù…Ø©
    function applyTranslation(lang) {
      const elements = translations[lang];
      if (!elements) return;

      // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
      Object.keys(elements).forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.textContent = elements[id];
        }
      });

      // ØªØ·Ø¨ÙŠÙ‚ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù€ placeholders
      const inputs = document.querySelectorAll('input[data-placeholder-ar], textarea[data-placeholder-ar]');
      inputs.forEach(input => {
        if (lang === 'en') {
          input.placeholder = input.getAttribute('data-placeholder-en');
        } else {
          input.placeholder = input.getAttribute('data-placeholder-ar');
        }
      });

      // ØªØºÙŠÙŠØ± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ
      if (lang === 'en') {
        document.documentElement.setAttribute('dir', 'ltr');
        document.documentElement.setAttribute('lang', 'en');
        // ØªØºÙŠÙŠØ± Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†ØµÙˆØµ
        document.querySelectorAll('main, section').forEach(el => {
          el.classList.remove('text-right');
          el.classList.add('text-left');
        });
      } else {
        document.documentElement.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('lang', 'ar');
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†ØµÙˆØµ Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
        document.querySelectorAll('main, section').forEach(el => {
          el.classList.remove('text-left');
          el.classList.add('text-right');
        });
      }

      currentLanguage = lang;
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', function() {
      // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø£Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
      const savedLanguage = localStorage.getItem('selectedLanguage') || 'ar';
      applyTranslation(savedLanguage);
      
      // Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ù„ØºØ©
      const languageToggle = document.getElementById('languageToggle');
      if (languageToggle) {
        languageToggle.addEventListener('click', function() {
          const newLang = currentLanguage === 'ar' ? 'en' : 'ar';
          applyTranslation(newLang);
          localStorage.setItem('selectedLanguage', newLang);
        });
      }
    });
  </script>

  <!-- Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø§Øª -->
  <script src="../assets/js/auth-check.js"></script>
</body>
</html>

